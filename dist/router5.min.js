!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).router5={})}(this,function(e){"use strict";var E=function(){return(E=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1,urlParamsEncoding:"default"};function y(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}}function f(e){return encodeURIComponent(e)}function d(e){return decodeURIComponent(e)}function p(n,e,t){var r,a="index"===(r=t).arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===r.arrayFormat?function(e){return e+"[]"}:function(e){return e};return e.map(function(e,t){return a(n,t)+"="+f(e)}).join("&")}function S(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)}function T(e){var t=e.indexOf("["),n=-1!==t;return{hasBrackets:n,name:n?e.slice(0,t):e}}function P(e,t){var l=y(t);return S(e).split("&").reduce(function(e,t){var n=t.split("="),r=n[0],a=n[1],o=T(r),i=o.hasBrackets,u=o.name,s=e[u],c=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}if("unicode"===t.booleanFormat){if("✓"===d(e))return!0;if("✗"===d(e))return!1}return"string"===t.nullFormat&&"null"===e?null:d(e)}(a,l);return e[u]=void 0===s?i?[c]:c:(Array.isArray(s)?s:[s]).concat(c),e},{})}function g(c,e){var l=y(e);return Object.keys(c).filter(function(e){return void 0!==c[e]}).map(function(e){return n=c[t=e],r=l,null===n?(a=t,"hidden"===(o=r).nullFormat?"":"string"===o.nullFormat?a+"=null":a):"boolean"==typeof n?(i=t,u=n,"empty-true"===(s=r).booleanFormat&&u?i:i+"="+("unicode"===s.booleanFormat?u?"✓":"✗":u.toString())):Array.isArray(n)?p(t,n,r):t+"="+f(n);var t,n,r,a,o,i,u,s}).filter(Boolean).join("&")}function a(e){return e.replace(t,function(e){return encodeURIComponent(e)})}function c(e,t,n){var r=o[t]||a;return n?String(e).split("/").map(r).join("/"):r(String(e))}function l(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@$]+")+")"}function h(e){return null!=e}function s(e){var s="";return e.reduce(function(e,t){var n,r,a,o,i=null!=(r=null===(n=t.parser)||void 0===n?void 0:n.urlParams.reduce(function(e,t){return e[t]="url",e},{}))?r:{},u=null!=(o=null===(a=t.parser)||void 0===a?void 0:a.queryParams.reduce(function(e,t){return e[t]="query",e},i))?o:{};return void 0!==t.name&&(e[s=s?s+"."+t.name:t.name]=u),e},{})}function O(e,s,c,l,f){void 0===l&&(l={});for(var t=l.queryParamsMode,d=void 0===t?"default":t,n=l.strictTrailingSlash,p=void 0!==n&&n,r=l.strongMatching,h=void 0===r||r,a=l.caseSensitive,m=void 0!==a&&a,v=1===e.length&&""===e[0].name,o=function(e){var t=null,n=void 0,r=s;if("/"===f&&"/"===e.path&&(r="/"+s),e.children.length||(t=e.parser.test(r,{caseSensitive:m,strictTrailingSlash:p,queryParams:l.queryParams,urlParamsEncoding:l.urlParamsEncoding})),t=t||e.parser.partialTest(r,{delimited:h,caseSensitive:m,queryParams:l.queryParams,urlParamsEncoding:l.urlParamsEncoding})){var a=e.parser.build(t,{ignoreSearch:!0,urlParamsEncoding:l.urlParamsEncoding});p||e.children.length||(a=a.replace(/\/$/,"")),n=0===r.toLowerCase().indexOf(a.toLowerCase())?r.slice(a.length):r,p||e.children.length||(n=n.replace(/^\/\?/,"?"));var o=function(e,i,t){var n=y(t);if(""===S(e))return{querystring:"",removedParams:{}};var r=e.split("&").reduce(function(e,t){var n=e[0],r=e[1],a=t.split("=")[0],o=T(a).name;return-1===i.indexOf(o)?[n.concat(t),r]:[n,r.concat(t)]},[[],[]]),a=r[0],o=r[1];return{querystring:a.join("&"),removedParams:P(o.join("&"),n)}}(r.replace(a,"").split("?")[1]||"",e.parser.queryParams,l.queryParams).querystring;if(n=n.split("?")[0]+(o?"?"+o:""),p||v||"/"!==n||/\/$/.test(a)||(n=""),c.segments.push(e),Object.keys(t).forEach(function(e){return c.params[e]=t[e]}),!v&&!n.length)return{value:c};if(!v&&"strict"!==d&&0===n.indexOf("?")){var i=P(n.slice(1),l.queryParams);return Object.keys(i).forEach(function(e){return c.params[e]=i[e]}),{value:c}}var u=e.getNonAbsoluteChildren();return u.length?{value:O(u,n,c,l,a)}:{value:null}}},i=0,u=e;i<u.length;i++){var g=o(u[i]);if("object"==typeof g)return g.value}return null}var m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},v=function(){return(v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=/[^!$'()*+,;|:]/g,o={default:a,uri:encodeURI,uriComponent:encodeURIComponent,none:function(e){return e},legacy:encodeURI},R={default:decodeURIComponent,uri:decodeURI,uriComponent:decodeURIComponent,none:function(e){return e},legacy:decodeURIComponent},i=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(l(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+l(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],r={urlParamsEncoding:"default"},N=function(){function n(e,t){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.options=v(v({},r),t),this.tokens=function n(r,a){if(void 0===a&&(a=[]),!i.some(function(e){var t=r.match(e.pattern);return!!t&&(a.push({type:e.name,match:t[0],val:t.slice(1,2),otherVal:t.slice(2),regex:e.regex instanceof Function?e.regex(t):e.regex}),t[0].length<r.length&&(a=n(r.substr(t[0].length),a)),!0)}))throw new Error("Could not parse path '"+r+"'");return a}(e),this.hasUrlParams=0<this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length,this.hasSpatParam=0<this.tokens.filter(function(e){return/splat$/.test(e.type)}).length,this.hasMatrixParams=0<this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length,this.hasQueryParams=0<this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}return n.createPath=function(e,t){return new n(e,t)},n.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},n.prototype.isSpatParam=function(e){return-1!==this.spatParams.indexOf(e)},n.prototype.test=function(e,t){var n,r=this,a=v(v({caseSensitive:!1,strictTrailingSlash:!1},this.options),t),o=(n=this.source,a.strictTrailingSlash||"\\/"===n?n:n.replace(/\\\/$/,"")+"(?:\\/)?"),i=this.urlTest(e,o+(this.hasQueryParams?"(\\?.*$|$)":"$"),a.caseSensitive,a.urlParamsEncoding);if(!i||!this.hasQueryParams)return i;var u=P(e,a.queryParams);return 0===Object.keys(u).filter(function(e){return!r.isQueryParam(e)}).length?(Object.keys(u).forEach(function(e){return i[e]=u[e]}),i):null},n.prototype.partialTest=function(e,t){var n,r=this,a=v(v({caseSensitive:!1,delimited:!0},this.options),t),o=(n=this.source,a.delimited?/(\/)$/.test(n)?n:n+"(\\/|\\?|\\.|;|$)":n),i=this.urlTest(e,o,a.caseSensitive,a.urlParamsEncoding);if(!i)return i;if(!this.hasQueryParams)return i;var u=P(e,a.queryParams);return Object.keys(u).filter(function(e){return r.isQueryParam(e)}).forEach(function(e){return function(e,t,n){void 0===n&&(n="");var r=e[t];return e[t]=void 0===r?n:Array.isArray(r)?r.concat(n):[r,n],e}(i,e,u[e])}),i},n.prototype.build=function(a,e){var o=this;void 0===a&&(a={});var i=v(v({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},this.options),e),t=Object.keys(a).filter(function(e){return!o.isQueryParam(e)}).reduce(function(e,t){if(!h(a[t]))return e;var n=a[t],r=o.isSpatParam(t);return"boolean"==typeof n?e[t]=n:Array.isArray(n)?e[t]=n.map(function(e){return c(e,i.urlParamsEncoding,r)}):e[t]=c(n,i.urlParamsEncoding,r),e},{});if(this.urlParams.some(function(e){return!h(a[e])})){var n=this.urlParams.filter(function(e){return!h(a[e])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+n.join(", ")+" }")}if(!i.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+l(e.otherVal[0])+"$").test(t[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var r=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+t[e.val[0]]:/^url-parameter/.test(e.type)?t[e.val[0]]:e.match}).join("");if(i.ignoreSearch)return r;var u=this.queryParams.filter(function(e){return-1!==Object.keys(a).indexOf(e)}).reduce(function(e,t){return e[t]=a[t],e},{}),s=g(u,i.queryParams);return s?r+"?"+s:r},n.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map(function(e){return e.val[0]})},n.prototype.urlTest=function(e,t,n,r){var a=this,o=new RegExp("^"+t,n?"":"i"),i=e.match(o);return i?this.urlParams.length?i.slice(1,this.urlParams.length+1).reduce(function(e,t,n){return e[a.urlParams[n]]=(R[r]||decodeURIComponent)(t),e},{}):{}:null},n}();var A=function(){function i(e,t,n,r){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=[]),void 0===r&&(r={}),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new N(this.path):null,this.children=[],this.parent=r.parent,this.checkParents(),this.add(n,r.onAdd,!r.finalSort&&!1!==r.sort),r.finalSort&&this.sortDescendants(),this}return i.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},i.prototype.setParent=function(e){this.parent=e,this.checkParents()},i.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new N(e):null},i.prototype.add=function(e,t,n){var r=this;if(void 0===n&&(n=!0),null==e)return this;if(e instanceof Array)return e.forEach(function(e){return r.add(e,t,n)}),this;if(!(e instanceof i||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof i)e.setParent(this),this.addRouteNode(e,n);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new i(e.name,e.path,e.children,{finalSort:!1,onAdd:t,parent:this,sort:n}),o=a.getParentSegments([a]).map(function(e){return e.name}).join(".");t&&t(m(m({},e),{name:o})),this.addRouteNode(a,n)}return this},i.prototype.addNode=function(e,t){return this.add(new i(e,t)),this},i.prototype.getPath=function(e){var t,n=this.getSegmentsByName(e);return n?(t=n)?t.map(function(e){return e.path}).join(""):null:null},i.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},i.prototype.sortChildren=function(){var e,t;this.children.length&&(e=this.children,t=e.slice(0),e.sort(function(v){return function(e,t){var n,r,a,o,i,u,s=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),c=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===s)return 1;if("/"===c)return-1;if(null===(n=e.parser)||void 0===n?void 0:n.hasSpatParam)return 1;if(null===(r=t.parser)||void 0===r?void 0:r.hasSpatParam)return-1;var l=(s.match(/\//g)||[]).length,f=(c.match(/\//g)||[]).length;if(l<f)return 1;if(f<l)return-1;var d=null!=(o=null===(a=e.parser)||void 0===a?void 0:a.urlParams.length)?o:0,p=null!=(u=null===(i=t.parser)||void 0===i?void 0:i.urlParams.length)?u:0;if(d<p)return-1;if(p<d)return 1;var h=(s.split("/").slice(-1)[0]||"").length,m=(c.split("/").slice(-1)[0]||"").length;return h<m?1:m<h?-1:v.indexOf(e)-v.indexOf(t)}}(t)))},i.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},i.prototype.buildPath=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var r=this.getSegmentsByName(e);if(!r)throw new Error("[route-node][buildPath] '{routeName}' is not defined");return function(e,o,i){void 0===o&&(o={}),void 0===i&&(i={});for(var t=i.queryParamsMode,n=void 0===t?"default":t,r=i.trailingSlashMode,a=void 0===r?"default":r,u=[],s=[],c=0,l=e;c<l.length;c++){var f=l[c].parser;f&&(u.push.apply(u,f.queryParams),s.push.apply(s,f.urlParams),s.push.apply(s,f.spatParams))}if("loose"===n){var d=Object.keys(o).reduce(function(e,t){return-1===u.indexOf(t)&&-1===s.indexOf(t)?e.concat(t):e},[]);u.push.apply(u,d)}var p=u.reduce(function(e,t){return-1!==Object.keys(o).indexOf(t)&&(e[t]=o[t]),e},{}),h=g(p,i.queryParams),m=e.reduce(function(e,t){var n,r,a=null!=(r=null===(n=t.parser)||void 0===n?void 0:n.build(o,{ignoreSearch:!0,queryParams:i.queryParams,urlParamsEncoding:i.urlParamsEncoding}))?r:"";return t.absolute?a:e+a},"").replace(/\/\/{1,}/g,"/"),v=m;return"always"===a?v=/\/$/.test(m)?m:m+"/":"never"===a&&"/"!==m&&(v=/\/$/.test(m)?m.slice(0,-1):m),v+(h?"?"+h:"")}(r,t,n)},i.prototype.buildState=function(e,t){void 0===t&&(t={});var n=this.getSegmentsByName(e);return n&&n.length?{name:e,params:t,meta:s(n)}:null},i.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var n=this.getSegmentsMatchingPath(e,t);if(!n)return null;var r=n.segments;if(r[0].absolute){var a=r[0].getParentSegments();r.reverse(),r.push.apply(r,a),r.reverse()}var o,i=r[r.length-1].findSlashChild();return i&&r.push(i),(o=n)&&o.segments&&o.segments.length?{name:o.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:o.params,meta:s(o.segments)}:null},i.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var n=e.name.split(".");if(1===n.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{var r=this.getSegmentsByName(n.slice(0,-1).join("."));if(!r)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=n[n.length-1],r[r.length-1].add(e)}return this},i.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},i.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},i.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},i.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},i.prototype.getSegmentsByName=function(e){var a=[],o=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var t,n,r=(t=e,(n=o.filter(function(e){return e.name===t})).length?n[0]:void 0);return!!r&&(o=r.children,a.push(r),!0)})?a:null},i.prototype.getSegmentsMatchingPath=function(e,t){var n=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),r=O(n,e,{segments:[],params:{}},t);return r&&1===r.segments.length&&""===r.segments[0].name?null:r},i}(),b={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},_={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function w(i){var o=0,t=null;return i.getState=function(){return t},i.setState=function(e){t=e},i.makeState=function(e,t,n,r,a){return{name:e,params:E(E({},i.config.defaultParams[e]),t),path:n,meta:r?E(E({},r),{id:void 0===a?++o:a}):void 0}},i.makeNotFoundState=function(e,t){return i.makeState(_.UNKNOWN_ROUTE,{path:e},e,{options:t})},i.areStatesEqual=function(t,n,e){if(void 0===e&&(e=!0),t.name!==n.name)return!1;function r(e){return i.rootNode.getSegmentsByName(e).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])}var a=e?r(t.name):Object.keys(t.params),o=e?r(n.name):Object.keys(n.params);return a.length===o.length&&a.every(function(e){return t.params[e]===n.params[e]})},i.areStatesDescendants=function(t,n){return!!new RegExp("^"+t.name+"\\.(.*)$").test(n.name)&&Object.keys(t.params).every(function(e){return t.params[e]===n.params[e]})},i.forwardState=function(e,t){var n=i.config.forwardMap[e]||e;return{name:n,params:E(E(E({},i.config.defaultParams[e]),i.config.defaultParams[n]),t)}},i.buildState=function(e,t){var n=i.forwardState(e,t),r=n.name,a=n.params;return i.rootNode.buildState(r,a)},i}var n,C={onStart:_.ROUTER_START,onStop:_.ROUTER_STOP,onTransitionSuccess:_.TRANSITION_SUCCESS,onTransitionStart:_.TRANSITION_START,onTransitionError:_.TRANSITION_ERROR,onTransitionCancel:_.TRANSITION_CANCEL};function I(a){var o=[];return a.getPlugins=function(){return o},a.usePlugin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.map(function(e){return o.push(e),t=e,n=a.executeFactory(t),r=Object.keys(C).map(function(e){if(n[e])return a.addEventListener(C[e],n[e])}).filter(Boolean),function(){r.forEach(function(e){return e()}),n.teardown&&n.teardown()};var t,n,r});return function(){o=o.filter(function(e){return-1===t.indexOf(e)}),n.forEach(function(e){return e()})}},a}function j(r){var a=[],o=[];return r.useMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.map(function(t){var n=r.executeFactory(t);return a.push(t),o.push(n),function(){a=a.filter(function(e){return e!==t}),o=o.filter(function(e){return e!==n})}});return function(){return n.forEach(function(e){return e()})}},r.clearMiddleware=function(){return a=[],o=[],r},r.getMiddlewareFactories=function(){return a},r.getMiddlewareFunctions=function(){return o},r}n="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")();var k,x,U=("function"==typeof(x=n.Symbol)?x.observable?k=x.observable:(k=x("observable"),x.observable=k):k="@@observable",k);function D(a){var r={};function t(e){var t="object"==typeof e,n=t?e.next.bind(e):e,r=a.addEventListener(_.TRANSITION_SUCCESS,function(e,t){n({route:e,previousRoute:t})});return t?{unsubscribe:r}:r}function e(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return t(e)}})[U]=function(){return this},e}return a.invokeEventListeners=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(r[e]||[]).forEach(function(e){return e.apply(void 0,t)})},a.removeEventListener=function(e,t){r[e]=r[e].filter(function(e){return e!==t})},a.addEventListener=function(e,t){return r[e]=(r[e]||[]).concat(t),function(){return a.removeEventListener(e,t)}},a.subscribe=t,a[U]=e,a["@@observable"]=e,a}var q=function(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])},F=function(e){return e&&e.meta&&e.meta.params},L=function(e,n){return F(n)&&null!=n.meta.params[e]?Object.keys(n.meta.params[e]).reduce(function(e,t){return e[t]=n.params[t],e},{}):{}};function M(o,i){var e,t=o.meta&&o.meta&&o.meta.options||{},u=i?q(i.name):[],s=q(o.name),n=Math.min(u.length,s.length);e=!i||t.reload?0:F(i)||F(o)?function(){function e(){var e=u[a],t=s[a];if(e!==t)return{value:a};var n=L(e,o),r=L(t,i);return Object.keys(n).length!==Object.keys(r).length?{value:a}:0===Object.keys(n).length?"continue":Object.keys(n).some(function(e){return r[e]!==n[e]})?{value:a}:void 0}var a;for(a=0;a<n;a+=1){var t=e();if("object"==typeof t)return t.value}return a}():0;var r=u.slice(e).reverse(),a=s.slice(e);return{intersection:i&&0<e?u[e-1]:"",toDeactivate:r,toActivate:a}}function $(i,e,u){function s(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path}function c(e,t,i,u){function n(e,t){var n,r,a,o;e?u(e):t&&t!==i&&s(t)?(a=t,(o=i).name===a.name&&o.params===a.params&&o.path===a.path||console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),u(null,(n=t,E(E(E({},r=i),n),{meta:E(E({},r.meta),n.meta)})))):u(null,i)}var r=e.call(null,i,a,n);l()?n(null):"boolean"==typeof r?n(r?null:t):s(r)?n(null,r):r&&"function"==typeof r.then&&r.then(function(e){e instanceof Error?n({error:e},null):n(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),n(E(E({},t),{promiseError:e}),null)):n("object"==typeof e?E(E({},t),e):t,null)})}var l=e.isCancelled,t=e.toState,a=e.fromState,n=e.errorKey,f=void 0===n?void 0:n,d=Array.isArray(i)?i:Object.keys(i),p=function(e,t){var n;if(l())u();else if(e)u(e);else if(d.length){var r="string"==typeof d[0],a=f&&r?((n={})[f]=d[0],n):{},o=r?i[d[0]]:d[0];d=d.slice(1),c(o,a,t,p)}else u(null,t)};p(null,t)}function z(r,a,e,t,o){function i(){return n}function u(e,t){return E(E({},e),t instanceof Object?t:{error:t})}var n=!1,s=!1,c=r.getOptions(),l=r.getLifecycleFunctions(),f=l[0],d=l[1],p=r.getMiddlewareFunctions(),h=a.name===_.UNKNOWN_ROUTE,m={isCancelled:i,toState:a,fromState:e},v=M(a,e),g=v.toDeactivate,y=v.toActivate,S=!e||t.forceDeactivate?[]:function(e,t,n){$(g.filter(function(e){return f[e]}).reduce(function(e,t){var n;return E(E({},e),((n={})[t]=f[t],n))},{}),E(E({},m),{errorKey:"segment"}),function(e){return n(e?u({code:b.CANNOT_DEACTIVATE},e):null)})},T=h?[]:function(e,t,n){$(y.filter(function(e){return d[e]}).reduce(function(e,t){var n;return E(E({},e),((n={})[t]=d[t],n))},{}),E(E({},m),{errorKey:"segment"}),function(e){return n(e?u({code:b.CANNOT_ACTIVATE},e):null)})},P=p.length?function(n,e,r){return $(p,E({},m),function(e,t){return r(e?u({code:b.TRANSITION_ERR},e):null,t||n)})}:[];return $([].concat(S).concat(T).concat(P),m,function(e,t){if(s=!0,!i()){if(!e&&c.autoCleanUp){var n=q(a.name);Object.keys(f).forEach(function(e){-1===n.indexOf(e)&&r.clearCanDeactivate(e)})}o(e,t||a)}}),function(){n||s||(n=!0,o({code:b.TRANSITION_CANCELLED},null))}}function B(){}function Z(f){var o;function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],r=e[e.length-1],a="function"==typeof r?r:B,o="object"==typeof e[1]?e[1]:{},i="object"==typeof e[2]?e[2]:{};if(f.isStarted()){var u=f.buildState(n,o);if(!u){var s={code:b.ROUTE_NOT_FOUND};return a(s),void f.invokeEventListeners(_.TRANSITION_ERROR,null,f.getState(),s)}var c=f.makeState(u.name,u.params,f.buildPath(u.name,u.params),{params:u.meta,options:i});if(!!f.getState()&&f.areStatesEqual(f.getState(),c,!1)&&!i.reload&&!i.force){s={code:b.SAME_STATES};return a(s),void f.invokeEventListeners(_.TRANSITION_ERROR,c,f.getState(),s)}var l=f.getState();return i.skipTransition?(a(null,c),B):f.transitionToState(c,l,i,function(e,t){if(e)if(e.redirect){var n=e.redirect;d(n.name,n.params,E(E({},i),{force:!0,redirected:!0}),a)}else a(e);else f.invokeEventListeners(_.TRANSITION_SUCCESS,t,l,i),a(null,t)})}a({code:b.ROUTER_NOT_STARTED})}return f.navigate=d,f.navigate=d,f.navigateToDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="object"==typeof e[0]?e[0]:{},r=2===e.length?e[1]:"function"==typeof e[0]?e[0]:B,a=f.getOptions();return a.defaultRoute?d(a.defaultRoute,a.defaultParams,n,r):function(){}},f.cancel=function(){return o&&(o("navigate"),o=null),f},f.transitionToState=function(n,r,e,a){return void 0===e&&(e={}),void 0===a&&(a=B),f.cancel(),f.invokeEventListeners(_.TRANSITION_START,n,r),o=z(f,n,r,e,function(e,t){o=null,t=t||n,e?(e.code===b.TRANSITION_CANCELLED?f.invokeEventListeners(_.TRANSITION_CANCEL,n,r):f.invokeEventListeners(_.TRANSITION_ERROR,n,r,e),a(e)):(f.setState(t),a(null,t))})},f}function Q(){}function K(f){var d=!1;return f.isStarted=function(){return d},f.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r,a=f.getOptions(),o=e[e.length-1],i="function"==typeof o?o:Q,u="function"!=typeof e[0]?e[0]:void 0;if(d)return i({code:b.ROUTER_ALREADY_STARTED}),f;d=!0,f.invokeEventListeners(_.ROUTER_START);function s(e,t,n){void 0===n&&(n=!0),e||f.invokeEventListeners(_.TRANSITION_SUCCESS,t,null,{replace:!0}),e&&n&&f.invokeEventListeners(_.TRANSITION_ERROR,t,null,e),i(e,t)}if(void 0===u&&!a.defaultRoute)return s({code:b.NO_START_PATH_OR_STATE});if("string"==typeof u?n=u:"object"==typeof u&&(r=u),r)f.setState(r),s(null,r);else{r=void 0===n?null:f.matchPath(n);var c=function(){return f.navigateToDefault({replace:!0},i)},l=function(e){f.transitionToState(e,f.getState(),{},function(e,t){var n;e?e.redirect?(n=e.redirect,f.navigate(n.name,n.params,{replace:!0,reload:!0,redirected:!0},i)):a.defaultRoute?c():s(e,null,!1):s(null,t)})};r?l(r):a.defaultRoute?c():a.allowNotFound?l(f.makeNotFoundState(n,{replace:!0})):s({code:b.ROUTE_NOT_FOUND,path:n},null)}return f},f.stop=function(){return d&&(f.setState(null),d=!1,f.invokeEventListeners(_.ROUTER_STOP)),f},f}function V(e){return"function"==typeof e?e:function(){return function(){return e}}}function W(r){var a={},o={},i={},u={};return r.getLifecycleFactories=function(){return[a,o]},r.getLifecycleFunctions=function(){return[i,u]},r.canDeactivate=function(e,t){var n=V(t);return a[e]=n,i[e]=r.executeFactory(n),r},r.clearCanDeactivate=function(e){return a[e]=void 0,i[e]=void 0,r},r.canActivate=function(e,t){var n=V(t);return o[e]=n,u[e]=r.executeFactory(n),r},r}function H(e,t,n){var a,o,i;return void 0===e&&(e=[]),void 0===t&&(t={}),void 0===n&&(n={}),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce(function(e,t){return t(e)},e)}}((i=t,function(n){var r=E(E({},u),i);return n.getOptions=function(){return r},n.setOption=function(e,t){return r[e]=t,n},n}),(o=n,function(n){var r=o;return n.setDependency=function(e,t){return r[e]=t,n},n.setDependencies=function(t){return Object.keys(t).forEach(function(e){return n.setDependency(e,t[e])}),n},n.getDependencies=function(){return r},n.getInjectables=function(){return[n,n.getDependencies()]},n.executeFactory=function(e){return e.apply(void 0,n.getInjectables())},n}),D,w,K,W,Z,I,j,(a=e,function(d){d.forward=function(e,t){return d.config.forwardMap[e]=t,d};var r=a instanceof A?a:new A("","",a,{onAdd:n});function n(e){e.canActivate&&d.canActivate(e.name,e.canActivate),e.forwardTo&&d.forward(e.name,e.forwardTo),e.decodeParams&&(d.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(d.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(d.config.defaultParams[e.name]=e.defaultParams)}return d.rootNode=r,d.add=function(e,t){return r.add(e,n,!t),t&&r.sortDescendants(),d},d.addNode=function(e,t,n){return r.addNode(e,t),n&&d.canActivate(e,n),d},d.isActive=function(e,t,n,r){void 0===t&&(t={}),void 0===n&&(n=!1),void 0===r&&(r=!0);var a=d.getState();return!!a&&(n||a.name===e?d.areStatesEqual(d.makeState(e,t),a,r):d.areStatesDescendants(d.makeState(e,t),a))},d.buildPath=function(e,t){if(e===_.UNKNOWN_ROUTE)return t.path;var n=E(E({},d.config.defaultParams[e]),t),r=d.getOptions(),a=r.trailingSlashMode,o=r.queryParamsMode,i=r.queryParams,u=d.config.encoders[e]?d.config.encoders[e](n):n;return d.rootNode.buildPath(e,u,{trailingSlashMode:a,queryParamsMode:o,queryParams:i,urlParamsEncoding:d.getOptions().urlParamsEncoding})},d.matchPath=function(e,t){var n=d.getOptions(),r=d.rootNode.matchPath(e,n);if(r){var a=r.name,o=r.params,i=r.meta,u=d.config.decoders[a]?d.config.decoders[a](o):o,s=d.forwardState(a,u),c=s.name,l=s.params,f=!1===n.rewritePathOnMatch?e:d.buildPath(c,l);return d.makeState(c,l,f,{params:i,source:t})}return null},d.setRootPath=function(e){d.rootNode.setPath(e)},d}))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})}e.RouteNode=A,e.cloneRouter=function(e,t){var n=H(e.rootNode,e.getOptions(),t);n.useMiddleware.apply(n,e.getMiddlewareFactories()),n.usePlugin.apply(n,e.getPlugins()),n.config=e.config;var r=e.getLifecycleFactories(),a=r[0],o=r[1];return Object.keys(a).forEach(function(e){return n.canDeactivate(e,a[e])}),Object.keys(o).forEach(function(e){return n.canActivate(e,o[e])}),n},e.constants=_,e.createRouter=H,e.default=H,e.errorCodes=b,e.transitionPath=M,Object.defineProperty(e,"__esModule",{value:!0})});
