!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.router5={})}(this,function(e){"use strict";var P=function(){return(P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1};function y(e){return void 0===e&&(e={}),{arrayFormat:e.arrayFormat||"none",booleanFormat:e.booleanFormat||"none",nullFormat:e.nullFormat||"default"}}function l(e){return encodeURIComponent(e)}function d(e){return decodeURIComponent(e)}function p(r,e,t){var n,a="index"===(n=t).arrayFormat?function(e,t){return e+"["+t+"]"}:"brackets"===n.arrayFormat?function(e){return e+"[]"}:function(e){return e};return e.map(function(e,t){return a(r,t)+"="+l(e)}).join("&")}function T(e){var t=e.indexOf("?");return-1===t?e:e.slice(t+1)}function S(e){var t=e.indexOf("["),r=-1!==t;return{hasBrackets:r,name:r?e.slice(0,t):e}}function O(e,t){var f=y(t);return T(e).split("&").reduce(function(e,t){var r=t.split("="),n=r[0],a=r[1],i=S(n),o=i.hasBrackets,u=i.name,s=e[u],c=function(e,t){if(void 0===e)return"empty-true"===t.booleanFormat||null;if("string"===t.booleanFormat){if("true"===e)return!0;if("false"===e)return!1}else if("unicode"===t.booleanFormat){if("✓"===d(e))return!0;if("✗"===d(e))return!1}else if("string"===t.nullFormat&&"null"===e)return null;return d(e)}(a,f);return e[u]=void 0===s?o?[c]:c:[].concat(s,c),e},{})}function m(c,e){var f=y(e);return Object.keys(c).filter(function(e){return void 0!==c[e]}).map(function(e){return r=c[t=e],n=f,null===r?(a=t,"hidden"===(i=n).nullFormat?"":"string"===i.nullFormat?a+"=null":a):"boolean"==typeof r?(o=t,u=r,"empty-true"===(s=n).booleanFormat&&u?o:o+"="+("unicode"===s.booleanFormat?u?"✓":"✗":u.toString())):Array.isArray(r)?p(t,r,n):t+"="+l(r);var t,r,n,a,i,o,u,s}).filter(Boolean).join("&")}function c(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@]+")+")"}function f(e){return e}function h(e){return null!=e}var v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},t=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(c(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(e){return new RegExp(";"+e[1]+"="+c(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(e){return new RegExp(e[0])}}],a=function(r,n){if(void 0===n&&(n=[]),!t.some(function(e){var t=r.match(e.pattern);return!!t&&(n.push({type:e.name,match:t[0],val:t.slice(1,2),otherVal:t.slice(2),regex:e.regex instanceof Function?e.regex(t):e.regex}),t[0].length<r.length&&(n=a(r.substr(t[0].length),n)),!0)}))throw new Error("Could not parse path '"+r+"'");return n},s=(r.createPath=function(e){return new r(e)},r.prototype.isQueryParam=function(e){return-1!==this.queryParams.indexOf(e)},r.prototype.test=function(e,t){var r,n=this,a=v({strictTrailingSlash:!1,queryParams:{}},t),i=(r=this.source,a.strictTrailingSlash?r:"\\/"===r?r:r.replace(/\\\/$/,"")+"(?:\\/)?"),o=this.urlTest(e,i+(this.hasQueryParams?"(\\?.*$|$)":"$"),t);if(!o||!this.hasQueryParams)return o;var u=O(e,a.queryParams);return 0===Object.keys(u).filter(function(e){return!n.isQueryParam(e)}).length?(Object.keys(u).forEach(function(e){return o[e]=u[e]}),o):null},r.prototype.partialTest=function(e,t){var r,n=this,a=v({delimited:!0,queryParams:{}},t),i=(r=this.source,a.delimited?/(\/)$/.test(r)?r:r+"(\\/|\\?|\\.|;|$)":r),o=this.urlTest(e,i,a);if(!o)return o;if(!this.hasQueryParams)return o;var u=O(e,a.queryParams);return Object.keys(u).filter(function(e){return n.isQueryParam(e)}).forEach(function(e){return function(e,t,r){void 0===r&&(r="");var n=e[t];return e[t]=void 0===n?r:Array.isArray(n)?n.concat(r):[n,r],e}(o,e,u[e])}),o},r.prototype.build=function(a,e){var i=this;void 0===a&&(a={});var t=v({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},e),r=Object.keys(a).filter(function(e){return!i.isQueryParam(e)}).reduce(function(e,t){if(!h(a[t]))return e;var r=a[t],n=i.isQueryParam(t)?f:encodeURI;return"boolean"==typeof r?e[t]=r:Array.isArray(r)?e[t]=r.map(n):e[t]=n(r),e},{});if(this.urlParams.some(function(e){return!h(a[e])})){var n=this.urlParams.filter(function(e){return!h(a[e])});throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+n.join(", ")+" }")}if(!t.ignoreConstraints&&!this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(e){return new RegExp("^"+c(e.otherVal[0])+"$").test(r[e.val])}))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var o=this.tokens.filter(function(e){return!1===/^query-parameter/.test(e.type)}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+r[e.val[0]]:/^url-parameter/.test(e.type)?r[e.val[0]]:e.match}).join("");if(t.ignoreSearch)return o;var u=this.queryParams.filter(function(e){return-1!==Object.keys(a).indexOf(e)}).reduce(function(e,t){return e[t]=a[t],e},{}),s=m(u,t.queryParams);return s?o+"?"+s:o},r.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map(function(e){return e.val[0]})},r.prototype.urlTest=function(e,t,r){var n=this,a=(void 0===r?{}:r).caseSensitive,i=new RegExp("^"+t,void 0!==a&&a?"":"i"),o=e.match(i);return o?this.urlParams.length?o.slice(1,this.urlParams.length+1).reduce(function(e,t,r){return e[n.urlParams[r]]=decodeURIComponent(t),e},{}):{}:null},r);function r(e){if(!e)throw new Error("Missing path in Path constructor");this.path=e,this.tokens=a(e),this.hasUrlParams=0<this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length,this.hasSpatParam=0<this.tokens.filter(function(e){return/splat$/.test(e.type)}).length,this.hasMatrixParams=0<this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length,this.hasQueryParams=0<this.tokens.filter(function(e){return/^query-parameter/.test(e.type)}).length,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter(function(e){return void 0!==e.regex}).map(function(e){return e.regex.source}).join("")}function g(e){var a="";return e.reduce(function(e,t){var r=t.parser.urlParams.reduce(function(e,t){return e[t]="url",e},{}),n=t.parser.queryParams.reduce(function(e,t){return e[t]="query",e},r);return void 0!==t.name&&(e[a=a?a+"."+t.name:t.name]=n),e},{})}var o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},E=function(e,s,c,f,l){void 0===f&&(f={});for(var t=f.queryParamsMode,d=void 0===t?"default":t,r=f.strictTrailingSlash,p=void 0!==r&&r,n=f.strongMatching,h=void 0===n||n,a=f.caseSensitive,m=void 0!==a&&a,v=1===e.length&&""===e[0].name,i=function(e){var t,r=void 0,n=s;if("/"===l&&"/"===e.path&&(n="/"+s),e.children.length||(t=e.parser.test(n,{caseSensitive:m,strictTrailingSlash:p,queryParams:f.queryParams})),t=t||e.parser.partialTest(n,{delimited:h,caseSensitive:m,queryParams:f.queryParams})){var a=e.parser.build(t,{ignoreSearch:!0});p||e.children.length||(a=a.replace(/\/$/,"")),r=0===n.toLowerCase().indexOf(a.toLowerCase())?n.slice(a.length):n,p||e.children.length||(r=r.replace(/^\/\?/,"?"));var i=function(e,o,t){var r=y(t);if(""===T(e))return{querystring:"",removedParams:{}};var n=e.split("&").reduce(function(e,t){var r=e[0],n=e[1],a=t.split("=")[0],i=S(a).name;return-1===o.indexOf(i)?[r.concat(t),n]:[r,n.concat(t)]},[[],[]]),a=n[0],i=n[1];return{querystring:a.join("&"),removedParams:O(i.join("&"),r)}}(n.replace(a,"").split("?")[1]||"",e.parser.queryParams,f.queryParams).querystring;if(r=r.split("?")[0]+(i?"?"+i:""),p||v||"/"!==r||/\/$/.test(a)||(r=""),c.segments.push(e),Object.keys(t).forEach(function(e){return c.params[e]=t[e]}),!v&&!r.length)return{value:c};if(!v&&"strict"!==d&&0===r.indexOf("?")){var o=O(r.slice(1),f.queryParams);return Object.keys(o).forEach(function(e){return c.params[e]=o[e]}),{value:c}}var u=e.getNonAbsoluteChildren();return u.length?{value:E(u,r,c,f,a)}:{value:null}}},o=0,u=e;o<u.length;o++){var g=i(u[o]);if("object"==typeof g)return g.value}return null};function n(e){var f,t=e.slice(0);return e.sort((f=t,function(e,t){var r=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),n=t.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===r)return 1;if("/"===n)return-1;if(e.parser.hasSpatParam)return 1;if(t.parser.hasSpatParam)return-1;var a=(r.match(/\//g)||[]).length,i=(n.match(/\//g)||[]).length;if(a<i)return 1;if(i<a)return-1;var o=e.parser.urlParams.length,u=t.parser.urlParams.length;if(o<u)return-1;if(u<o)return 1;var s=(r.split("/").slice(-1)[0]||"").length,c=(n.split("/").slice(-1)[0]||"").length;return s<c?1:c<s?-1:f.indexOf(e)-f.indexOf(t)}))}o({},{queryParamsMode:"default",trailingSlashMode:"default"},{strongMatching:!0});var R=(N.prototype.getParentSegments=function(e){return void 0===e&&(e=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(e.concat(this.parent)):e.reverse()},N.prototype.setParent=function(e){this.parent=e,this.checkParents()},N.prototype.setPath=function(e){void 0===e&&(e=""),this.path=e,this.parser=e?new s(e):null},N.prototype.add=function(e,t,r){var n=this;if(void 0===r&&(r=!0),null!=e){if(!(e instanceof Array)){if(!(e instanceof N||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof N)e.setParent(this),this.addRouteNode(e,r);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var a=new N(e.name,e.path,e.children,t,this,!1,r),i=a.getParentSegments([a]).map(function(e){return e.name}).join(".");t&&t(o({},e,{name:i})),this.addRouteNode(a,r)}return this}e.forEach(function(e){return n.add(e,t,r)})}},N.prototype.addNode=function(e,t){return this.add(new N(e,t)),this},N.prototype.getPath=function(e){return(t=this.getSegmentsByName(e))?t.map(function(e){return e.path}).join(""):null;var t},N.prototype.getNonAbsoluteChildren=function(){return this.children.filter(function(e){return!e.absolute})},N.prototype.sortChildren=function(){this.children.length&&n(this.children)},N.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach(function(e){return e.sortDescendants()})},N.prototype.buildPath=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),function(e,n,a){if(void 0===n&&(n={}),void 0===a&&(a={}),!e)return null;for(var t=a.queryParamsMode,r=void 0===t?"default":t,i=(a.trailingSlashMode,[]),o=[],u=0,s=e;u<s.length;u++){var c=s[u].parser;i.push.apply(i,c.queryParams),o.push.apply(o,c.urlParams),o.push.apply(o,c.spatParams)}if("loose"===r){var f=Object.keys(n).reduce(function(e,t){return-1===i.indexOf(t)&&-1===o.indexOf(t)?e.concat(t):e},[]);i.push.apply(i,f)}var l=i.reduce(function(e,t){return-1!==Object.keys(n).indexOf(t)&&(e[t]=n[t]),e},{}),d=m(l,a.queryParams),p=e.reduce(function(e,t){var r=t.parser.build(n,{ignoreSearch:!0,queryParams:a.queryParams});return t.absolute?r:e+r},"").replace(/\/\/{1,}/g,"/"),h=p;return"always"===a.trailingSlashMode?h=/\/$/.test(p)?p:p+"/":"never"===a.trailingSlashMode&&"/"!==p&&(h=/\/$/.test(p)?p.slice(0,-1):p),h+(d?"?"+d:"")}(this.getSegmentsByName(e),t,r)},N.prototype.buildState=function(e,t){void 0===t&&(t={});var r=this.getSegmentsByName(e);return r&&r.length?{name:e,params:t,meta:g(r)}:null},N.prototype.matchPath=function(e,t){void 0===t&&(t={}),""!==e||t.strictTrailingSlash||(e="/");var r,n=this.getSegmentsMatchingPath(e,t);if(n){var a=n.segments;if(a[0].absolute){var i=a[0].getParentSegments();a.reverse(),a.push.apply(a,i),a.reverse()}var o=a[a.length-1].findSlashChild();o&&a.push(o)}return(r=n)&&r.segments&&r.segments.length?{name:r.segments.map(function(e){return e.name}).filter(function(e){return e}).join("."),params:r.params,meta:g(r.segments)}:null},N.prototype.addRouteNode=function(e,t){void 0===t&&(t=!0);var r=e.name.split(".");if(1===r.length){if(-1!==this.children.map(function(e){return e.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(e){return e.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),t&&this.sortChildren()}else{var n=this.getSegmentsByName(r.slice(0,-1).join("."));if(!n)throw new Error("Could not add route named '"+e.name+"', parent is missing.");e.name=r[r.length-1],n[n.length-1].add(e)}return this},N.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},N.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var e=this.parent.parser;return e.hasUrlParams||e.hasSpatParam||e.hasMatrixParams||e.hasQueryParams||this.parent.hasParentsParams()}return!1},N.prototype.findAbsoluteChildren=function(){return this.children.reduce(function(e,t){return e.concat(t.absolute?t:[]).concat(t.findAbsoluteChildren())},[])},N.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter(function(e){return e.parser&&/^\/(\?|$)/.test(e.parser.path)})[0]},N.prototype.getSegmentsByName=function(e){var a=[],i=this.parser?[this]:this.children;return(this.parser?[""]:[]).concat(e.split(".")).every(function(e){var t,r,n=(t=e,(r=i.filter(function(e){return e.name===t})).length?r[0]:void 0);return!!n&&(i=n.children,a.push(n),!0)})?a:null},N.prototype.getSegmentsMatchingPath=function(e,t){var r=(this.parser?[this]:this.children).reduce(function(e,t){return e.concat(t,t.findAbsoluteChildren())},[]),n=E(r,e,{segments:[],params:{}},t);return n&&1===n.segments.length&&""===n.segments[0].name?null:n},N);function N(e,t,r,n,a,i,o){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=[]),void 0===i&&(i=!0),this.name=e,this.absolute=/^~/.test(t),this.path=this.absolute?t.slice(1):t,this.parser=this.path?new s(this.path):null,this.children=[],this.parent=a,this.checkParents(),this.add(r,n,!i&&!1!==o),i&&this.sortDescendants(),this}var A={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},b={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"};function _(o){var i=0,t=null;return o.getState=function(){return t},o.setState=function(e){t=e},o.makeState=function(e,t,r,n,a){return{name:e,params:P({},o.config.defaultParams[e],t),path:r,meta:n?P({},n,{id:void 0===a?++i:a}):void 0}},o.makeNotFoundState=function(e,t){return o.makeState(b.UNKNOWN_ROUTE,{path:e},e,{options:t})},o.areStatesEqual=function(t,r,e){if(void 0===e&&(e=!0),t.name!==r.name)return!1;function n(e){return o.rootNode.getSegmentsByName(e).map(function(e){return e.parser.urlParams}).reduce(function(e,t){return e.concat(t)},[])}var a=e?n(t.name):Object.keys(t.params),i=e?n(r.name):Object.keys(r.params);return a.length===i.length&&a.every(function(e){return t.params[e]===r.params[e]})},o.areStatesDescendants=function(t,r){return!!new RegExp("^"+t.name+"\\.(.*)$").test(r.name)&&Object.keys(t.params).every(function(e){return t.params[e]===r.params[e]})},o.forwardState=function(e,t){var r=o.config.forwardMap[e]||e;return{name:r,params:P({},o.config.defaultParams[e],o.config.defaultParams[r],t)}},o.buildState=function(e,t){var r=o.forwardState(e,t),n=r.name,a=r.params;return o.rootNode.buildState(n,a)},o}var i,w={onStart:b.ROUTER_START,onStop:b.ROUTER_STOP,onTransitionSuccess:b.TRANSITION_SUCCESS,onTransitionStart:b.TRANSITION_START,onTransitionError:b.TRANSITION_ERROR,onTransitionCancel:b.TRANSITION_CANCEL};function C(a){var i=[];return a.getPlugins=function(){return i},a.usePlugin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.map(function(e){return i.push(e),t=e,r=a.executeFactory(t),n=Object.keys(w).map(function(e){if(r[e])return a.addEventListener(w[e],r[e])}).filter(Boolean),function(){n.forEach(function(e){return e()}),r.teardown&&r.teardown()};var t,r,n});return function(){i=i.filter(function(e){return-1===t.indexOf(e)}),r.forEach(function(e){return e()})}},a}function k(n){var a=[],i=[];return n.useMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.map(function(t){var r=n.executeFactory(t);return a.push(t),i.push(r),function(){a=a.filter(function(e){return e!==t}),i=i.filter(function(e){return e!==r})}});return function(){return r.forEach(function(e){return e()})}},n.clearMiddleware=function(){return a=[],i=[],n},n.getMiddlewareFactories=function(){return a},n.getMiddlewareFunctions=function(){return i},n}i="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")();var j,I,x=("function"==typeof(I=i.Symbol)?I.observable?j=I.observable:(j=I("observable"),I.observable=j):j="@@observable",j);function q(a){var n={};function t(e){var t="object"==typeof e,r=t?e.next.bind(e):e,n=a.addEventListener(b.TRANSITION_SUCCESS,function(e,t){r({route:e,previousRoute:t})});return t?{unsubscribe:n}:n}function e(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");return t(e)}})[x]=function(){return this},e}return a.invokeEventListeners=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];(n[e]||[]).forEach(function(e){return e.apply(void 0,t)})},a.removeEventListener=function(e,t){n[e]=n[e].filter(function(e){return e!==t})},a.addEventListener=function(e,t){return n[e]=(n[e]||[]).concat(t),function(){return a.removeEventListener(e,t)}},a.subscribe=t,a[x]=e,a["@@observable"]=e,a}var U=function(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])},D=function(e){return e&&e.meta&&e.meta.params},F=function(e,r){return D(r)&&null!=r.meta.params[e]?Object.keys(r.meta.params[e]).reduce(function(e,t){return e[t]=r.params[t],e},{}):{}};function M(i,o){var e,t=i.meta&&i.meta&&i.meta.options||{},u=o?U(o.name):[],s=U(i.name),r=Math.min(u.length,s.length);e=!o||t.reload?0:D(o)||D(i)?function(){function e(){var e=u[a],t=s[a];if(e!==t)return{value:a};var r=F(e,i),n=F(t,o);return Object.keys(r).length!==Object.keys(n).length?{value:a}:0===Object.keys(r).length?"continue":Object.keys(r).some(function(e){return n[e]!==r[e]})?{value:a}:void 0}var a;for(a=0;a<r;a+=1){var t=e();if("object"==typeof t)return t.value}return a}():0;var n=u.slice(e).reverse(),a=s.slice(e);return{intersection:o&&0<e?u[e-1]:"",toDeactivate:n,toActivate:a}}function L(o,e,u){function s(e){return"object"==typeof e&&void 0!==e.name&&void 0!==e.params&&void 0!==e.path}function c(e,t,o,u){function r(e,t){var r,n,a,i;e?u(e):t&&t!==o&&s(t)?(a=t,(i=o).name===a.name&&i.params===a.params&&i.path===a.path||console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),u(null,P({},n=o,r=t,{meta:P({},n.meta,r.meta)}))):u(null,o)}var n=e.call(null,o,a,r);f()?r(null):"boolean"==typeof n?r(n?null:t):s(n)?r(null,n):n&&"function"==typeof n.then&&n.then(function(e){e instanceof Error?r({error:e},null):r(null,e)},function(e){e instanceof Error?(console.error(e.stack||e),r(P({},t,{promiseError:e}),null)):r("object"==typeof e?P({},t,e):t,null)})}var f=e.isCancelled,t=e.toState,a=e.fromState,r=e.errorKey,l=void 0===r?void 0:r,d=Array.isArray(o)?o:Object.keys(o),p=function(e,t){var r;if(f())u();else if(e)u(e);else if(d.length){var n="string"==typeof d[0],a=l&&n?((r={})[l]=d[0],r):{},i=n?o[d[0]]:d[0];d=d.slice(1),c(i,a,t,p)}else u(null,t)};p(null,t)}function $(n,a,e,t,i){function o(){return r}function u(e,t){return P({},e,t instanceof Object?t:{error:t})}var r=!1,s=!1,c=n.getOptions(),f=n.getLifecycleFunctions(),l=f[0],d=f[1],p=n.getMiddlewareFunctions(),h=a.name===b.UNKNOWN_ROUTE,m={isCancelled:o,toState:a,fromState:e},v=M(a,e),g=v.toDeactivate,y=v.toActivate,T=!e||t.forceDeactivate?[]:function(e,t,r){L(g.filter(function(e){return l[e]}).reduce(function(e,t){var r;return P({},e,((r={})[t]=l[t],r))},{}),P({},m,{errorKey:"segment"}),function(e){return r(e?u({code:A.CANNOT_DEACTIVATE},e):null)})},S=h?[]:function(e,t,r){L(y.filter(function(e){return d[e]}).reduce(function(e,t){var r;return P({},e,((r={})[t]=d[t],r))},{}),P({},m,{errorKey:"segment"}),function(e){return r(e?u({code:A.CANNOT_ACTIVATE},e):null)})},O=p.length?function(r,e,n){return L(p,P({},m),function(e,t){return n(e?u({code:A.TRANSITION_ERR},e):null,t||r)})}:[];return L([].concat(T).concat(S).concat(O),m,function(e,t){if(s=!0,!o()){if(!e&&c.autoCleanUp){var r=U(a.name);Object.keys(l).forEach(function(e){-1===r.indexOf(e)&&n.clearCanDeactivate(e)})}i(e,t||a)}}),function(){r||s||(r=!0,i({code:A.TRANSITION_CANCELLED},null))}}function z(e,t){}function B(l){var i;function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=e[e.length-1],a="function"==typeof n?n:z,i="object"==typeof e[1]?e[1]:{},o="object"==typeof e[2]?e[2]:{};if(l.isStarted()){var u=l.buildState(r,i);if(!u){var s={code:A.ROUTE_NOT_FOUND};return a(s),void l.invokeEventListeners(b.TRANSITION_ERROR,null,l.getState(),s)}var c=l.makeState(u.name,u.params,l.buildPath(u.name,u.params),{params:u.meta,options:o});if(!!l.getState()&&l.areStatesEqual(l.getState(),c,!1)&&!o.reload&&!o.force){s={code:A.SAME_STATES};return a(s),void l.invokeEventListeners(b.TRANSITION_ERROR,c,l.getState(),s)}var f=l.getState();return o.skipTransition?(a(null,c),z):l.transitionToState(c,f,o,function(e,t){if(e)if(e.redirect){var r=e.redirect;d(r.name,r.params,P({},o,{force:!0,redirected:!0}),a)}else a(e);else l.invokeEventListeners(b.TRANSITION_SUCCESS,t,f,o),a(null,t)})}a({code:A.ROUTER_NOT_STARTED})}return l.navigate=d,l.navigate=d,l.navigateToDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="object"==typeof e[0]?e[0]:{},n=2===e.length?e[1]:"function"==typeof e[0]?e[0]:z,a=l.getOptions();return a.defaultRoute?d(a.defaultRoute,a.defaultParams,r,n):function(){}},l.cancel=function(){return i&&(i("navigate"),i=null),l},l.transitionToState=function(r,n,e,a){return void 0===e&&(e={}),void 0===a&&(a=z),l.cancel(),l.invokeEventListeners(b.TRANSITION_START,r,n),i=$(l,r,n,e,function(e,t){i=null,t=t||r,e?(e.code===A.TRANSITION_CANCELLED?l.invokeEventListeners(b.TRANSITION_CANCEL,r,n):l.invokeEventListeners(b.TRANSITION_ERROR,r,n,e),a(e)):(l.setState(t),a(null,t))})},l}function Q(){}function Z(l){var d=!1;return l.isStarted=function(){return d},l.start=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,a=l.getOptions(),i=e[e.length-1],o="function"==typeof i?i:Q,u="function"!=typeof e[0]?e[0]:void 0;if(d)return o({code:A.ROUTER_ALREADY_STARTED}),l;d=!0,l.invokeEventListeners(b.ROUTER_START);function s(e,t,r){void 0===r&&(r=!0),e||l.invokeEventListeners(b.TRANSITION_SUCCESS,t,null,{replace:!0}),e&&r&&l.invokeEventListeners(b.TRANSITION_ERROR,t,null,e),o(e,t)}if(void 0===u&&!a.defaultRoute)return s({code:A.NO_START_PATH_OR_STATE});if("string"==typeof u?r=u:"object"==typeof u&&(n=u),n)l.setState(n),s(null,n);else{n=void 0===r?null:l.matchPath(r);var c=function(){return l.navigateToDefault({replace:!0},o)},f=function(e){l.transitionToState(e,l.getState(),{},function(e,t){var r;e?e.redirect?(r=e.redirect,l.navigate(r.name,r.params,{replace:!0,reload:!0,redirected:!0},o)):a.defaultRoute?c():s(e,null,!1):s(null,t)})};n?f(n):a.defaultRoute?c():a.allowNotFound?f(l.makeNotFoundState(r,{replace:!0})):s({code:A.ROUTE_NOT_FOUND,path:r},null)}return l},l.stop=function(){return d&&(l.setState(null),d=!1,l.invokeEventListeners(b.ROUTER_STOP)),l},l}function K(e){return"function"==typeof e?e:function(){return function(){return e}}}function V(n){var a={},i={},o={},u={};return n.getLifecycleFactories=function(){return[a,i]},n.getLifecycleFunctions=function(){return[o,u]},n.canDeactivate=function(e,t){var r=K(t);return a[e]=r,o[e]=n.executeFactory(r),n},n.clearCanDeactivate=function(e){return a[e]=void 0,o[e]=void 0,n},n.canActivate=function(e,t){var r=K(t);return i[e]=r,u[e]=n.executeFactory(r),n},n}function W(e,t,r){var a,i,o;return void 0===e&&(e=[]),void 0===t&&(t={}),void 0===r&&(r={}),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce(function(e,t){return t(e)},e)}}((o=t,function(r){var n=P({},u,o);return r.getOptions=function(){return n},r.setOption=function(e,t){return n[e]=t,r},r}),(i=r,function(r){var n=i;return r.setDependency=function(e,t){return n[e]=t,r},r.setDependencies=function(t){return Object.keys(t).forEach(function(e){return r.setDependency(e,t[e])}),r},r.getDependencies=function(){return n},r.getInjectables=function(){return[r,r.getDependencies()]},r.executeFactory=function(e){return e.apply(void 0,r.getInjectables())},r}),q,_,Z,V,B,C,k,(a=e,function(d){d.forward=function(e,t){return d.config.forwardMap[e]=t,d};var n=a instanceof R?a:new R("","",a,r);function r(e){e.canActivate&&d.canActivate(e.name,e.canActivate),e.forwardTo&&d.forward(e.name,e.forwardTo),e.decodeParams&&(d.config.decoders[e.name]=e.decodeParams),e.encodeParams&&(d.config.encoders[e.name]=e.encodeParams),e.defaultParams&&(d.config.defaultParams[e.name]=e.defaultParams)}return d.rootNode=n,d.add=function(e,t){return n.add(e,r,!t),t&&n.sortDescendants(),d},d.addNode=function(e,t,r){return n.addNode(e,t),r&&d.canActivate(e,r),d},d.isActive=function(e,t,r,n){void 0===t&&(t={}),void 0===r&&(r=!1),void 0===n&&(n=!0);var a=d.getState();return!!a&&(r||a.name===e?d.areStatesEqual(d.makeState(e,t),a,n):d.areStatesDescendants(d.makeState(e,t),a))},d.buildPath=function(e,t){if(e===b.UNKNOWN_ROUTE)return t.path;var r=P({},d.config.defaultParams[e],t),n=d.getOptions(),a=n.trailingSlashMode,i=n.queryParamsMode,o=n.queryParams,u=d.config.encoders[e]?d.config.encoders[e](r):r;return d.rootNode.buildPath(e,u,{trailingSlashMode:a,queryParamsMode:i,queryParams:o})},d.matchPath=function(e,t){var r=d.getOptions(),n=d.rootNode.matchPath(e,r);if(n){var a=n.name,i=n.params,o=n.meta,u=d.config.decoders[a]?d.config.decoders[a](i):i,s=d.forwardState(a,u),c=s.name,f=s.params,l=!1===r.rewritePathOnMatch?e:d.buildPath(c,f);return d.makeState(c,f,l,{params:o,source:t})}return null},d.setRootPath=function(e){d.rootNode.setPath(e)},d}))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})}e.createRouter=W,e.cloneRouter=function(e,t){var r=W(e.rootNode,e.getOptions(),t);r.useMiddleware.apply(r,e.getMiddlewareFactories()),r.usePlugin.apply(r,e.getPlugins()),r.config=e.config;var n=e.getLifecycleFactories(),a=n[0],i=n[1];return Object.keys(a).forEach(function(e){return r.canDeactivate(e,a[e])}),Object.keys(i).forEach(function(e){return r.canActivate(e,i[e])}),r},e.RouteNode=R,e.transitionPath=M,e.constants=b,e.errorCodes=A,e.default=W,Object.defineProperty(e,"__esModule",{value:!0})});
