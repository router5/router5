!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.router5BrowserPlugin=t()}(this,function(){"use strict";var e={ROUTER_NOT_STARTED:"NOT_STARTED",NO_START_PATH_OR_STATE:"NO_START_PATH_OR_STATE",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},t={UNKNOWN_ROUTE:"@@router5/UNKNOWN_ROUTE",ROUTER_START:"$start",ROUTER_STOP:"$stop",TRANSITION_START:"$$start",TRANSITION_CANCEL:"$$cancel",TRANSITION_SUCCESS:"$$success",TRANSITION_ERROR:"$$error"},a=function(e){return function(){return e}},n=function(){},r=function(){return-1===window.navigator.userAgent.indexOf("Trident")},o="undefined"!=typeof window&&window.history?{getBase:function(){return window.location.pathname},pushState:function(e,t,a){return window.history.pushState(e,t,a)},replaceState:function(e,t,a){return window.history.replaceState(e,t,a)},addPopstateListener:function(e){window.addEventListener("popstate",e),r()||window.addEventListener("hashchange",e)},removePopstateListener:function(e){window.removeEventListener("popstate",e),r()||window.removeEventListener("hashchange",e)},getLocation:function(e){return((e.useHash?window.location.hash.replace(new RegExp("^#"+e.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+e.base),""))||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:a(""),pushState:n,replaceState:n,addPopstateListener:n,removePopstateListener:n,getLocation:a(""),getState:a(null),getHash:a("")};var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:!1,mergeState:!1,preserveHash:!0},u="popstate";return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=i({},s,a),c={forceDeactivate:r.forceDeactivate,source:u};function T(a){var o=a.getOptions(),s=a.start;function T(e,t,a){var o=e?{meta:e.meta,name:e.name,params:e.params,path:e.path}:e,s=!0===r.mergeState?i({},n.getState(),o):o;a?n.replaceState(s,"",t):n.pushState(s,"",t)}function p(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=a.getState(),l=!s.state||!s.state.name,h=l?a.matchPath(n.getLocation(r),u):a.makeState(s.state.name,s.state.params,s.state.path,i({},s.state.meta,{source:u}),s.state.meta.id),d=o.defaultRoute,f=o.defaultParams;h?p&&a.areStatesEqual(h,p,!1)||a.transitionToState(h,p,c,function(n,r){if(n)if(n.redirect){var o=n.redirect,s=o.name,u=o.params;a.navigate(s,u,i({},c,{replace:!0,force:!0,redirected:!0}))}else if(n.code===e.CANNOT_DEACTIVATE){var S=a.buildUrl(p.name,p.params);l||T(h,S,!0)}else d&&a.navigate(d,f,i({},c,{reload:!0,replace:!0}));else a.invokeEventListeners(t.TRANSITION_SUCCESS,r,p,{replace:!0})}):d&&a.navigateToDefault(i({},c,{reload:!0,replace:!0}))}return function(e,t){function a(e){var a=e.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(a?a[1]:e).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+e);var r=n[1],o=n[2]||"",i=n[3]||"";return(t.useHash?o.replace(new RegExp("^#"+t.hashPrefix),""):t.base?r.replace(new RegExp("^"+t.base),""):r)+i}e.urlToPath=a,e.buildUrl=function(a,n){var r=t.base||"",o=t.useHash?"#"+t.hashPrefix:"",i=e.buildPath(a,n);return null===i?null:r+o+i},e.matchUrl=function(t){return e.matchPath(a(t))}}(a,r),a.start=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return 0===t.length||"function"==typeof t[0]?s.apply(void 0,[n.getLocation(r)].concat(t)):s.apply(void 0,t),a},a.replaceHistoryState=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.buildState(e,t),o=a.buildUrl(e,t);a.lastKnownState=r,n.replaceState(r,"",o)},{onStart:function(){r.useHash&&!r.base&&(r.base=n.getBase()),n.addPopstateListener(p)},onStop:function(){n.removePopstateListener(p)},onTransitionSuccess:function(e,t,o){var i=n.getState(),s=i&&i.meta&&i.name&&i.params,u=t&&a.areStatesEqual(t,e,!1),c=o.replace||!s||u,p=a.buildUrl(e.name,e.params);null===t&&!1===r.useHash&&!0===r.preserveHash&&(p+=n.getHash()),T(e,p,c)},onPopState:p}}return T.pluginName="BROWSER_PLUGIN",T}});
