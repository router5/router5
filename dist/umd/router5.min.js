!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("router5",["exports"],e):e(t.router5={})}(this,function(t){"use strict";function e(t,e,n){var r=e.isCancelled,a=e.toState,i=e.fromState,o=e.additionalArgs,s=e.errorKey,h=Array.isArray(t)?t:Object.keys(t),f=function(t){return"object"===("undefined"==typeof t?"undefined":u(t))&&void 0!==t.name&&void 0!==t.params&&void 0!==t.path},m=function(t){return t.name!==a.name||t.params!==a.params||t.path!==a.path},d=function(e){if(!h.length)return!0;var n="string"==typeof h[0],f=s&&n?c({},s,h[0]):{},m=n?t[h[0]]:h[0],d=m.apply(null,o.concat([a,i,e]));return r()?e(null):"boolean"==typeof d?e(d?null:f):d&&"function"==typeof d.then&&d.then(function(t){t instanceof Error?e({error:t},null):e(null,t)},function(t){t instanceof Error?(console.error(t.stack||t),e(l({},f,{promiseError:t}),null)):e("object"===("undefined"==typeof t?"undefined":u(t))?l({},f,t):f,null)}),!1},g=function(t,e){t?n(t):(e&&f(e)&&(m(e)?console.error("[router5][transition] State values changed during transition process and ignored."):a=e),h=h.slice(1),p())},p=function(){if(r())n(null);else{var t=d(g);t&&n(null,a)}};p()}function n(t){return t.split(".").reduce(function(t,e){return t.concat(t.length?t[t.length-1]+"."+e:e)},[])}function r(t,e){return e._meta&&e._meta[t]?Object.keys(e._meta[t]).reduce(function(t,n){return t[n]=e.params[n],t},{}):{}}function a(t,e){function a(){var n=void 0,a=function(){var a=i[n],u=o[n];if(a!==u)return{v:n};var s=r(a,t),c=r(u,e);if(s.length!==c.length)return{v:n};if(0===s.length)return"continue";var l=Object.keys(s).some(function(t){return c[t]!==s[t]});return l?{v:n}:void 0};for(n=0;s>n;n+=1){var c=a();switch(c){case"continue":continue;default:if("object"===("undefined"==typeof c?"undefined":u(c)))return c.v}}return n}var i=e?n(e.name):[],o=n(t.name),s=Math.min(i.length,o.length),c=void 0;e?e&&(t.name!==e.name||t._meta&&e._meta)?c=a():(console.log("[router5.transition-path] Some states are missing metadata, reloading all segments"),c=0):c=0;var l=i.slice(c).reverse(),h=o.slice(c),f=e&&c>0?i[c-1]:"";return{intersection:f,toDeactivate:l,toActivate:h}}function i(t,r,i,u,o){var s=!1,f=t.getAdditionalArgs(),m=function(){return s},d=function(){return s=!0},g=function(e,a){e||m()||!t.options.autoCleanUp||!function(){var e=n(r.name);Object.keys(t._canDeact).forEach(function(n){-1===e.indexOf(n)&&(t._canDeact[n]=void 0)})}(),o(m()?{code:h.TRANSITION_CANCELLED}:e,a||r)},p=function(t,e){return l({},t,e instanceof Object?e:{error:e})},v=a(r,i),y=v.toDeactivate,A=v.toActivate,S={isCancelled:m,toState:r,fromState:i,additionalArgs:[]},_=function(n,r,a){var i=y.filter(function(e){return t._canDeact[e]}).reduce(function(e,n){return l({},e,c({},n,t._canDeact[n]))},{});e(i,l({},S,{additionalArgs:f,errorKey:"segment"}),function(t){return a(t?p({code:h.CANNOT_DEACTIVATE},t):null)})},k=function(n,r,a){var i=A.filter(function(e){return t._canAct[e]}).reduce(function(e,n){return l({},e,c({},n,t._canAct[n]))},{});e(i,l({},S,{additionalArgs:f,errorKey:"segment"}),function(t){return a(t?p({code:h.CANNOT_ACTIVATE},t):null)})},E=t.mware,P=function(n,r,a){var i=Array.isArray(t.mware)?t.mware:[t.mware];e(i,l({},S,{additionalArgs:f}),function(t,e){return a(t?p({code:h.TRANSITION_ERR},t):null,e||n)})},T=(i&&!u.forceDeactivate?[_]:[]).concat(k).concat(E?P:[]);return e(T,S,g),d}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},h={ROUTER_NOT_STARTED:"NOT_STARTED",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",TRANSITION_CANCELLED:"CANCELLED"},f=function(t){return t.split("?")[0]},m=function(t){return t.split("?")[1]},d=function(t){return void 0!==t&&null!==t&&""!==t},g=/\[\]$/,p=function(t){return t.replace(g,"")},v=function(t){return t.split("&").reduce(function(t,e){var n=e.split("="),r=n[0],a=n[1];return t.concat({name:r,value:decodeURIComponent(a)})},[])},y=function(t){return t.map(function(t){var e=t.name,n=t.value;return[e].concat(d(n)?encodeURIComponent(n):[])}).map(function(t){return t.join("=")}).join("&")},A=function(t,e){if(!t)return"";var n=v(t).filter(function(t){var n=t.name;return-1===e.indexOf(p(n))}),r=y(n);return r||""},S=function(t){return"("+(t?t.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~]+")+")"},_=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(S(t[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^\?]*)/},{name:"url-parameter-matrix",pattern:/^\;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(";"+t[1]+"="+S(t[2]))}},{name:"query-parameter-bracket",pattern:/^(?:\?|&)(?:\:)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(?:\[\])/},{name:"query-parameter",pattern:/^(?:\?|&)(?:\:)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(t){return new RegExp("\\"+t[0])}},{name:"sub-delimiter",pattern:/^(\!|\&|\-|_|\.|;)/,regex:function(t){return new RegExp(t[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(t){return new RegExp(t[0])}}],k=function I(t){var e=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=_.some(function(n){var r=t.match(n.pattern);return r?(e.push({type:n.name,match:r[0],val:r.slice(1,2),otherVal:r.slice(2),regex:n.regex instanceof Function?n.regex(r):n.regex}),r[0].length<t.length&&(e=I(t.substr(r[0].length),e)),!0):!1});if(!n)throw new Error("Could not parse path.");return e},E=function(t,e){return e?t.replace(/\\\/$/,"")+"(?:\\/)?":t},P=function(t){return t.replace(/\[\]$/,"")},T=function(t,e){var n=arguments.length<=2||void 0===arguments[2]?"":arguments[2];/\[\]$/.test(e)&&(e=P(e),n=[n]);var r=t[e];return void 0===r?t[e]=n:t[e]=Array.isArray(r)?r.concat(n):[r,n],t},b=function(t){var e=t.split("?")[1];return e?e.split("&").map(function(t){return t.split("=")}).reduce(function(t,e){return T(t,e[0],e[1]?decodeURIComponent(e[1]):e[1])},{}):{}},w=function(t){return void 0!==t&&null!==t&&""!==t?"="+encodeURIComponent(t):""},O=function M(t,e){return Array.isArray(e)?e.map(function(e){return M(t,e)}).join("&"):t+w(e)},R=function(){function t(e){if(o(this,t),!e)throw new Error("Please supply a path");this.path=e,this.tokens=k(e),this.hasUrlParams=this.tokens.filter(function(t){return/^url-parameter/.test(t.type)}).length>0,this.hasSpatParam=this.tokens.filter(function(t){return/splat$/.test(t.type)}).length>0,this.hasMatrixParams=this.tokens.filter(function(t){return/matrix$/.test(t.type)}).length>0,this.hasQueryParams=this.tokens.filter(function(t){return/^query-parameter/.test(t.type)}).length>0,this.urlParams=this.hasUrlParams?this.tokens.filter(function(t){return/^url-parameter/.test(t.type)}).map(function(t){return t.val.slice(0,1)}).reduce(function(t,e){return t.concat(e)}):[],this.queryParams=this.hasQueryParams?this.tokens.filter(function(t){return"query-parameter"===t.type}).map(function(t){return t.val}).reduce(function(t,e){return t.concat(e)},[]):[],this.queryParamsBr=this.hasQueryParams?this.tokens.filter(function(t){return/-bracket$/.test(t.type)}).map(function(t){return t.val}).reduce(function(t,e){return t.concat(e)},[]):[],this.params=this.urlParams.concat(this.queryParams).concat(this.queryParamsBr),this.source=this.tokens.filter(function(t){return void 0!==t.regex}).map(function(t){return t.regex.source}).join("")}return s(t,null,[{key:"createPath",value:function(e){return new t(e)}},{key:"serialise",value:function(t,e){return O(t,e)}}]),s(t,[{key:"_urlMatch",value:function(t,e){var n=this,r=t.match(e);return r?this.urlParams.length?r.slice(1,this.urlParams.length+1).reduce(function(t,e,r){return t[n.urlParams[r]]=e,t},{}):{}:null}},{key:"match",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=E(this.source,n),a=this._urlMatch(t,new RegExp("^"+r+(this.hasQueryParams?"(\\?.*$|$)":"$")));if(!a||!this.hasQueryParams)return a;var i=b(t),u=Object.keys(i).filter(function(t){return-1===e.queryParams.concat(e.queryParamsBr).indexOf(t)});return 0===u.length?(Object.keys(i).forEach(function(t){return a[t]=i[t]}),a):null}},{key:"partialMatch",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=E(this.source,n),a=this._urlMatch(t,new RegExp("^"+r));if(!a)return a;if(!this.hasQueryParams)return a;var i=b(t);return Object.keys(i).filter(function(t){return e.queryParams.concat(e.queryParamsBr).indexOf(t)>=0}).forEach(function(t){return T(a,t,i[t])}),a}},{key:"build",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?{ignoreConstraints:!1,ignoreSearch:!1}:arguments[1];if(this.urlParams.some(function(e){return void 0===t[e]}))throw new Error("Missing parameters");if(!e.ignoreConstraints){var n=this.tokens.filter(function(t){return/^url-parameter/.test(t.type)&&!/-splat$/.test(t.type)}).every(function(e){return new RegExp("^"+S(e.otherVal[0])+"$").test(t[e.val])});if(!n)throw new Error("Some parameters are of invalid format")}var r=this.tokens.filter(function(t){return/^query-parameter/.test(t.type)===!1}).map(function(e){return"url-parameter-matrix"===e.type?";"+e.val+"="+t[e.val[0]]:/^url-parameter/.test(e.type)?t[e.val[0]]:e.match}).join("");if(e.ignoreSearch)return r;var a=this.queryParams.concat(this.queryParamsBr.map(function(t){return t+"[]"})),i=a.filter(function(e){return-1!==Object.keys(t).indexOf(P(e))}).map(function(e){return O(e,t[P(e)])}).join("&");return r+(i?"?"+i:"")}}]),t}(),N=function(){},x=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],a=arguments[3];return o(this,t),this.name=e,this.path=n,this.parser=n?new R(n):null,this.children=[],this.add(r,a),this}return s(t,[{key:"setPath",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];this.path=t,this.parser=t?new R(t):null}},{key:"add",value:function(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?N:arguments[1],a=void 0;if(void 0!==e&&null!==e){if(e instanceof Array)return void e.forEach(function(t){return n.add(t,r)});if(!(e instanceof t||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof Object){if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");a=e,e=new t(e.name,e.path,e.children)}var i=e.name.split(".");if(1===i.length){if(-1!==this.children.map(function(t){return t.name}).indexOf(e.name))throw new Error('Alias "'+e.name+'" is already defined in route node');if(-1!==this.children.map(function(t){return t.path}).indexOf(e.path))throw new Error('Path "'+e.path+'" is already defined in route node');this.children.push(e),this.children.sort(function(t,e){var n=t.path.split("?")[0].replace(/(.+)\/$/,"$1"),r=e.path.split("?")[0].replace(/(.+)\/$/,"$1");if("/"===n)return 1;if("/"===r)return-1;if(t.parser.hasSpatParam)return 1;if(e.parser.hasSpatParam)return-1;var a=(n.match(/\//g)||[]).length,i=(r.match(/\//g)||[]).length;if(i>a)return 1;if(a>i)return-1;var u=t.parser.urlParams.length,o=e.parser.urlParams.length;if(o>u)return-1;if(u>o)return 1;var s=(n.split("/").slice(-1)[0]||"").length,c=(r.split("/").slice(-1)[0]||"").length;return c>s?1:s>c?-1:0})}else{var u=this.getSegmentsByName(i.slice(0,-1).join("."));if(!u)throw new Error("Could not add route named '"+e.name+"', parent is missing.");u[u.length-1].add(new t(i[i.length-1],e.path,e.children))}return a&&r(a),this}}},{key:"addNode",value:function(e,n){return this.add(new t(e,n)),this}},{key:"getSegmentsByName",value:function(t){var e=function(t,e){var n=e.filter(function(e){return e.name===t});return n.length?n[0]:void 0},n=[],r=this.parser?[this]:this.children,a=(this.parser?[""]:[]).concat(t.split(".")),i=a.every(function(t){var a=e(t,r);return a?(r=a.children,n.push(a),!0):!1});return i?n:null}},{key:"getSegmentsMatchingPath",value:function(t,e){var n=e.trailingSlash,r=e.strictQueryParams,a=function c(t,e,a){var i=function(i){var u=t[i],o=u.parser.partialMatch(e),s=void 0;if(!o&&n)o=u.parser.match(e,!0),s="";else if(o){var l=u.parser.build(o,{ignoreSearch:!0});s=e.replace(l,"");var h=A(m(e.replace(l,"")),u.parser.queryParams.concat(u.parser.queryParamsBr));s=f(s)+(h?"?"+h:""),n&&"/"===s&&!/\/$/.test(l)&&(s="")}return o?(a.push(u),Object.keys(o).forEach(function(t){return a.params[t]=o[t]}),!s.length||!r&&0===s.indexOf("?")?{v:a}:u.children.length?{v:c(u.children,s,a)}:{v:null}):void 0};for(var o in t){var s=i(o);if("object"===("undefined"==typeof s?"undefined":u(s)))return s.v}return null},i=this.parser?[this]:this.children,o=[];o.params={};var s=a(i,t,o);return s&&1===s.length&&""===s[0].name?null:s}},{key:"getPathFromSegments",value:function(t){return t?t.map(function(t){return t.path}).join(""):null}},{key:"getPath",value:function(t){return this.getPathFromSegments(this.getSegmentsByName(t))}},{key:"buildPathFromSegments",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!t)return null;var n=t.filter(function(t){return t.parser.hasQueryParams}).reduce(function(t,e){return t.concat(e.parser.queryParams).concat(e.parser.queryParamsBr.map(function(t){return t+"[]"}))},[]),r=n.length?n.filter(function(t){return-1!==Object.keys(e).indexOf(p(t))}).map(function(t){return R.serialise(t,e[p(t)])}).join("&"):null;return t.map(function(t){return t.parser.build(e,{ignoreSearch:!0})}).join("")+(r?"?"+r:"")}},{key:"getMetaFromSegments",value:function(t){var e="";return t.reduce(function(t,n){var r=n.parser.urlParams.reduce(function(t,e){return t[e]="url",t},{}),a=n.parser.queryParams.reduce(function(t,e){return t[e]="query",t},r);return void 0!==n.name&&(e=e?e+"."+n.name:n.name,t[e]=a),t},{})}},{key:"buildPath",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return this.buildPathFromSegments(this.getSegmentsByName(t),e)}},{key:"buildStateFromSegments",value:function(t){if(!t||!t.length)return null;var e=t.map(function(t){return t.name}).filter(function(t){return t}).join("."),n=t.params;return{name:e,params:n,_meta:this.getMetaFromSegments(t)}}},{key:"buildState",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this.getSegmentsByName(t);return n&&n.length?{name:t,params:e,_meta:this.getMetaFromSegments(n)}:null}},{key:"matchPath",value:function(t,e){var n={trailingSlash:!1,strictQueryParams:!0};return e=l({},n,e),this.buildStateFromSegments(this.getSegmentsMatchingPath(t,e))}}]),t}(),$=function(){},j=function(t,e){if(!t)throw new Error(e)},C=function(t,e,n,r){var a={},i=function(t,e){return Object.defineProperty(a,t,{value:e,enumerable:!0})};return i("name",t),i("params",e),i("path",n),r&&i("_meta",r),a},D=function(t){return function(e){e.canActivate&&t.canActivate(e.name,e.canActivate)}},L=function(t){return"function"==typeof t?t:function(){return t}},q=function(){function t(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,t),this.started=!1,this.mware=null,this._cbs={},this._canAct={},this._canDeact={},this.lastStateAttempt=null,this.lastKnownState=null,this.rootNode=e instanceof x?e:new x("","",e,D(this)),this.options={useHash:!1,hashPrefix:"",base:!1,trailingSlash:0,autoCleanUp:!0,strictQueryParams:!0},Object.keys(r).forEach(function(t){return n.options[t]=r[t]}),this.registeredPlugins={},this._extraArgs=[]}return s(t,[{key:"setOption",value:function(t,e){return this.options[t]=e,this}},{key:"setAdditionalArgs",value:function(t){return this._extraArgs=Array.isArray(t)?t:[t],this}},{key:"getAdditionalArgs",value:function(){return this._extraArgs}},{key:"add",value:function(t){return this.rootNode.add(t,D(this)),this}},{key:"addNode",value:function(t,e,n){return this.rootNode.addNode(t,e),n&&(this._canAct[t]=n),this}},{key:"usePlugin",value:function(t){var e=this;j("function"==typeof t,"[router5.usePlugin] Plugins are now functions, see http://router5.github.io/docs/plugins.html.");var n=t(this),r=n.name||t.name;j(r,"[router5.usePlugin] Tried to register an unamed plugin.");var a=["onStart","onStop","onTransitionSuccess","onTransitionStart","onTransitionError","onTransitionCancel"],i=a.some(function(t){return void 0!==n[t]});return j(i,"[router5.usePlugin] plugin "+n.name+" has none of the expected methods implemented"),this.registeredPlugins[r]=n,a.forEach(function(t){n[t]&&e._addListener(t.toLowerCase().replace(/^on/,"$$").replace(/transition/,"$$"),n[t])}),this}},{key:"useMiddleware",value:function(){var t=this;return this.mware=Array.prototype.slice.call(arguments).map(function(e){var n=e(t);return j("function"==typeof n,"[router5.usePlugin] Middleware have changed, see http://router5.github.io/docs/middleware.html."),n}),this}},{key:"start",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];var a=n.slice(-1)[0],i=a instanceof Function?a:$,o=void 0,s=void 0;if(this.started)return i({code:h.ROUTER_ALREADY_STARTED}),this;this.started=!0,this._invokeListeners("$start");var c=this.options;n.length>0&&("string"==typeof n[0]&&(o=n[0]),"object"===u(n[0])&&(s=n[0]));var l=function(e,n){var r=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];e||t._invokeListeners("$$success",n,null,{replace:!0}),e&&r&&t._invokeListeners("$$error",n,null,e),i(e,n)};return void 0===o&&void 0===s&&this.getLocation&&(o=this.getLocation()),s?(this.lastKnownState=s,l(null,s)):!function(){s=void 0===o?null:t.matchPath(o);var e=function(){return t.navigate(c.defaultRoute,c.defaultParams,{replace:!0},i)},n=function(e){return t.navigate(e.name,e.params,{replace:!0,reload:!0},i)};s?(t.lastStateAttempt=s,t._transition(t.lastStateAttempt,t.lastKnownState,{},function(t,r){t?t.redirect?n(t.redirect):c.defaultRoute?e():l(t,null,!1):l(null,r)})):c.defaultRoute?e():l({code:h.ROUTE_NOT_FOUND,path:o},null)}(),this}},{key:"stop",value:function(){return this.started?(this.lastKnownState=null,this.lastStateAttempt=null,this.started=!1,this._invokeListeners("$stop"),this):this}},{key:"getState",value:function(){return this.lastKnownState}},{key:"isActive",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!0:arguments[3],a=this.getState();return a?n||a.name===t?this.areStatesEqual(C(t,e),a,r):this.areStatesDescendants(C(t,e),a):!1}},{key:"areStatesEqual",value:function(t,e){var n=this,r=arguments.length<=2||void 0===arguments[2]?!0:arguments[2];if(t.name!==e.name)return!1;var a=function(t){return n.rootNode.getSegmentsByName(t).map(function(t){return t.parser[r?"urlParams":"params"]}).reduce(function(t,e){return t.concat(e)},[])},i=a(t.name),u=a(e.name);return i.length===u.length&&i.every(function(n){return t.params[n]===e.params[n]})}},{key:"areStatesDescendants",value:function(t,e){var n=new RegExp("^"+t.name+"\\.(.*)$");return n.test(e.name)?Object.keys(t.params).every(function(n){return t.params[n]===e.params[n]}):!1}},{key:"_invokeListeners",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];(this._cbs[t]||[]).forEach(function(t){return t.apply(void 0,n)})}},{key:"_addListener",value:function(t,e){return this._cbs[t]=(this._cbs[t]||[]).concat(e),this}},{key:"canDeactivate",value:function(t,e){return this._canDeact[t]=L(e),this}},{key:"canActivate",value:function(t,e){return this._canAct[t]=L(e),this}},{key:"buildUrl",value:function(t,e){return this._buildUrl(this.buildPath(t,e))}},{key:"_buildUrl",value:function(t){return(this.options.base||"")+(this.options.useHash?"#"+this.options.hashPrefix:"")+t}},{key:"buildPath",value:function(t,e){return this.rootNode.buildPath(t,e)}},{key:"buildState",value:function(t,e){return this.rootNode.buildState(t,e)}},{key:"matchPath",value:function(t){var e=this.options,n=e.trailingSlash,r=e.strictQueryParams,a=this.rootNode.matchPath(t,{trailingSlash:n,strictQueryParams:r});return a?C(a.name,a.params,t,a._meta):null}},{key:"urlToPath",value:function(t){var e=t.match(/^(?:http|https)\:\/\/(?:[0-9a-z_\-\.\:]+?)(?=\/)(.*)$/),n=e?e[1]:t,r=n.match(/^(.+?)(#.+?)?(\?.+)?$/);if(!r)throw new Error("[router5] Could not parse url "+t);var a=r[1],i=r[2]||"",u=r[3]||"",o=this.options;return(o.useHash?i.replace(new RegExp("^#"+o.hashPrefix),""):o.base?a.replace(new RegExp("^"+o.base),""):a)+u}},{key:"matchUrl",value:function(t){return this.matchPath(this.urlToPath(t))}},{key:"_transition",value:function(t,e){var n=this,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?$:arguments[3];this.cancel(),this._invokeListeners("$$start",t,e);var u=i(this,t,e,r,function(r,i){return i=i||t,n._tr=null,r?(r.code===h.TRANSITION_CANCELLED?n._invokeListeners("$$cancel",t,e):n._invokeListeners("$$error",t,e,r),void a(r)):(n.lastKnownState=i,void a(null,i))});return this._tr=u,function(){return!u||u()}}},{key:"cancel",value:function(){this._tr&&this._tr()}},{key:"navigate",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=this,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments.length<=3||void 0===arguments[3]?$:arguments[3];if(!this.started)return void a({code:h.ROUTER_NOT_STARTED});var i=this.buildState(t,e);if(!i){var u={code:h.ROUTE_NOT_FOUND};return a(u),void this._invokeListeners("$$error",null,this.lastKnownState,u)}i.path=this.buildPath(t,e),this.lastStateAttempt=i;var o=this.lastKnownState?this.areStatesEqual(this.lastKnownState,this.lastStateAttempt,!1):!1;if(o&&!r.reload){var u={code:h.SAME_STATES};return a(u),void this._invokeListeners("$$error",i,this.lastKnownState,u)}var s=o?null:this.lastKnownState;return this._transition(i,o?null:this.lastKnownState,r,function(t,e){return t?void(t.redirect?n.navigate(t.redirect.name,t.redirect.params,{reload:!0},a):a(t)):(n._invokeListeners("$$success",e,s,r),void a(null,e))})}}]),t}(),U=function(){return function(){var t=function(){return console.group("Router transition")},e=function(){return console.groupEnd("Router transition")};return{name:"LOGGER",onStart:function(){console.info("Router started")},onStop:function(){console.info("Router stopped")},onTransitionStart:function(n,r){e(),t(),console.log("Transition started from state"),console.log(r),console.log("To state"),console.log(n)},onTransitionCancel:function(){console.warn("Transition cancelled")},onTransitionError:function(t,n,r){console.warn("Transition error with code "+r.code),e()},onTransitionSuccess:function(){console.log("Transition success"),e()}}}};t["default"]=q,t.Router5=q,t.RouteNode=x,t.loggerPlugin=U,t.errCodes=h,t.transitionPath=a});