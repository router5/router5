/**
 * @license
 * @version 0.9.0
 * The MIT License (MIT)
 * 
 * Copyright (c) 2015 Thomas Roch
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
(function(e){var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function n(e){return"("+(e?e.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~]+")+")"};var a=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function i(e){return new RegExp(n(e[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^\?]*)/},{name:"url-parameter-matrix",pattern:/^\;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function i(e){return new RegExp(";"+e[1]+"="+n(e[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?:\:)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function i(e){return new RegExp("\\"+e[0])}},{name:"sub-delimiter",pattern:/^(\!|\&|\-|_|\.|;)/,regex:function i(e){return new RegExp(e[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+?)/,regex:function i(e){return new RegExp(e[0])}}];var u=function u(e){var t=arguments.length<=1||arguments[1]===undefined?[]:arguments[1];var r=a.some(function(r){var n=e.match(r.pattern);if(!n)return false;t.push({type:r.name,match:n[0],val:n.slice(1,2),otherVal:n.slice(2),regex:r.regex instanceof Function?r.regex(n):r.regex});if(n[0].length<e.length)t=u(e.substr(n[0].length),t);return true});if(!r){throw new Error("Could not parse path.")}return t};var s=function s(e,t){if(!t)return e;return e.replace(/\\\/$/,"")+"(?:\\/)?"};var o=function o(e,t){var r=arguments.length<=2||arguments[2]===undefined?"":arguments[2];var n=e[t];if(n===undefined)e[t]=r;else e[t]=Array.isArray(n)?n.concat(r):[n,r];return e};var l=function l(e){var t=e.split("?")[1];if(!t)return{};return t.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return o(e,t[0],t[1])},{})};var f=function f(e){return e!==undefined&&e!==null&&e!==""?"="+e:""};var c=function c(e,t){return Array.isArray(t)?t.map(function(t){return c(e,t)}).join("&"):e+f(t)};var h=function(){t(i,null,[{key:"createPath",value:function e(e){return new i(e)}},{key:"serialise",value:function a(e,t){return c(e,t)}}]);function i(e){r(this,i);if(!e)throw new Error("Please supply a path");this.path=e;this.tokens=u(e);this.hasUrlParams=this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).length>0;this.hasSpatParam=this.tokens.filter(function(e){return/splat$/.test(e.type)}).length>0;this.hasMatrixParams=this.tokens.filter(function(e){return/matrix$/.test(e.type)}).length>0;this.hasQueryParams=this.tokens.filter(function(e){return e.type==="query-parameter"}).length>0;this.urlParams=!this.hasUrlParams?[]:this.tokens.filter(function(e){return/^url-parameter/.test(e.type)}).map(function(e){return e.val.slice(0,1)}).reduce(function(e,t){return e.concat(t)});this.queryParams=!this.hasQueryParams?[]:this.tokens.filter(function(e){return e.type==="query-parameter"}).map(function(e){return e.val}).reduce(function(e,t){return e.concat(t)});this.params=this.urlParams.concat(this.queryParams);this.source=this.tokens.filter(function(e){return e.regex!==undefined}).map(function(e){return e.regex.source}).join("")}t(i,[{key:"_urlMatch",value:function f(e,t){var r=this;var n=e.match(t);if(!n)return null;else if(!this.urlParams.length)return{};return n.slice(1,this.urlParams.length+1).reduce(function(e,t,n){e[r.urlParams[n]]=t;return e},{})}},{key:"match",value:function h(e){var t=this;var r=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var n=s(this.source,r);var a=this._urlMatch(e,new RegExp("^"+n+(this.hasQueryParams?"\\?.*$":"$")));if(!a||!this.hasQueryParams)return a;var i=l(e);var u=Object.keys(i).filter(function(e){return t.queryParams.indexOf(e)===-1});if(u.length===0){Object.keys(i).forEach(function(e){return a[e]=i[e]});return a}return null}},{key:"partialMatch",value:function v(e){var t=this;var r=arguments.length<=1||arguments[1]===undefined?0:arguments[1];var n=s(this.source,r);var a=this._urlMatch(e,new RegExp("^"+n));if(!a)return a;if(!this.hasQueryParams)return a;var i=l(e);Object.keys(i).filter(function(e){return t.queryParams.indexOf(e)>=0}).forEach(function(e){return o(a,e,i[e])});return a}},{key:"build",value:function m(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var t=arguments.length<=1||arguments[1]===undefined?{ignoreConstraints:false,ignoreSearch:false}:arguments[1];if(this.urlParams.some(function(t){return e[t]===undefined}))throw new Error("Missing parameters");if(!t.ignoreConstraints){var r=this.tokens.filter(function(e){return/^url-parameter/.test(e.type)&&!/-splat$/.test(e.type)}).every(function(t){return new RegExp("^"+n(t.otherVal[0])+"$").test(e[t.val])});if(!r)throw new Error("Some parameters are of invalid format")}var a=this.tokens.filter(function(e){return e.type!=="query-parameter"}).map(function(t){if(t.type==="url-parameter-matrix")return";"+t.val[0]+"="+e[t.val[0]];return/^url-parameter/.test(t.type)?e[t.val[0]]:t.match}).join("");if(t.ignoreSearch)return a;var i=this.queryParams.filter(function(t){return Object.keys(e).indexOf(t)!==-1}).map(function(t){return c(t,e[t])}).join("&");return a+(i?"?"+i:"")}}]);return i}();var v=function(){function e(e,t){var r=[];var n=true;var a=false;var i=undefined;try{for(var u=e[Symbol.iterator](),s;!(n=(s=u.next()).done);n=true){r.push(s.value);if(t&&r.length===t)break}}catch(o){a=true;i=o}finally{try{if(!n&&u["return"])u["return"]()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var m=function m(e){return e!==undefined&&e!==null&&e!==""};var d=function d(e,t){if(e.indexOf("?")===-1)return e;var r=e.split("?");var n=v(r,2);var a=n[0];var i=n[1];var u=i.split("&").reduce(function(e,r){var n=r.split("=");var a=v(n,2);var i=a[0];var u=a[1];if(t.indexOf(i)===-1)e[i]=u||"";return e},{});var s=Object.keys(u).map(function(e){return[e].concat(m(u[e])?u[e]:[])}).map(function(e){return e.join("=")}).join("&");return a+(s?"?"+s:"")};var p=function(){function e(){var t=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var n=arguments.length<=1||arguments[1]===undefined?"":arguments[1];var a=arguments.length<=2||arguments[2]===undefined?[]:arguments[2];r(this,e);this.name=t;this.path=n;this.parser=n?new h(n):null;this.children=[];this.add(a);return this}t(e,[{key:"add",value:function n(t){var r=this;if(t===undefined||t===null)return;if(t instanceof Array){t.forEach(function(e){return r.add(e)});return}if(!(t instanceof e)&&!(t instanceof Object)){throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.")}if(t instanceof Object){if(!t.name||!t.path){throw new Error("RouteNode.add() expects routes to have a name and a path defined.")}t=new e(t.name,t.path,t.children)}if(this.children.map(function(e){return e.name}).indexOf(t.name)!==-1){throw new Error('Alias "'+t.name+'" is already defined in route node')}if(this.children.map(function(e){return e.path}).indexOf(t.path)!==-1){throw new Error('Path "'+t.path+'" is already defined in route node')}var n=t.name.split(".");if(n.length===1){this.children.push(t);this.children.sort(function(e,t){if(e.path==="/")return 1;if(t.path==="/")return-1;var r=e.parser.hasUrlParams||e.parser.hasSpatParam;var n=t.parser.hasUrlParams||t.parser.hasSpatParam;if(!r&&!n){return e.path&&t.path?e.path.length<t.path.length?1:-1:0}if(r&&!n)return 1;if(!r&&n)return-1;if(!e.parser.hasSpatParam&&t.parser.hasSpatParam)return-1;if(!t.parser.hasSpatParam&&e.parser.hasSpatParam)return 1;var a=(e.path.match(/\//g)||[]).length;var i=(t.path.match(/\//g)||[]).length;if(a<i)return 1;return 0})}else{var a=this.getSegmentsByName(n.slice(0,-1).join("."));if(a){a[a.length-1].add(new e(n[n.length-1],t.path,t.children))}else{throw new Error("Could not add route named '"+t.name+"', parent is missing.")}}return this}},{key:"addNode",value:function a(t,r){this.add(new e(t,r));return this}},{key:"getSegmentsByName",value:function i(e){var t=function t(e,t){var r=t.filter(function(t){return t.name===e});return r.length?r[0]:undefined};var r=[];var n=e.split(".");var a=this.children;var i=n.every(function(e){var n=t(e,a);if(n){a=n.children;r.push(n);return true}return false});return i?r:null}},{key:"getSegmentsMatchingPath",value:function u(e){var t=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var r=function r(e,n,a){var i=function(i){var u=e[i];var s=u.parser.partialMatch(n);var o=undefined,l=undefined;if(!s&&t){s=u.parser.match(n,true);o=""}else if(s){var f=u.parser.build(s,{ignoreSearch:true});o=d(n.replace(f,""),u.parser.queryParams);if(t&&o==="/"&&!/\/$/.test(f)){o=""}}if(s){a.push(u);Object.keys(s).forEach(function(e){return a.params[e]=s[e]});if(!o.length){return{v:a}}if(!u.children.length){return{v:null}}return{v:r(u.children,o,a)}}};for(var u in e){var s=i(u);if(typeof s==="object")return s.v}return null};var n=this.parser?[this]:this.children;var a=[];a.params={};return r(n,e,a)}},{key:"getPathFromSegments",value:function s(e){return e?e.map(function(e){return e.path}).join(""):null}},{key:"getPath",value:function o(e){return this.getPathFromSegments(this.getSegmentsByName(e))}},{key:"buildPathFromSegments",value:function l(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!e)return null;var r=e.filter(function(e){return e.parser.hasQueryParams}).map(function(e){return e.parser.queryParams});var n=!r.length?null:r.reduce(function(e,t){return e.concat(t)}).filter(function(e){return Object.keys(t).indexOf(e)!==-1}).map(function(e){return h.serialise(e,t[e])}).join("&");return e.map(function(e){return e.parser.build(t,{ignoreSearch:true})}).join("")+(n?"?"+n:"")}},{key:"buildPath",value:function f(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return this.buildPathFromSegments(this.getSegmentsByName(e),t)}},{key:"getMatchPathFromSegments",value:function c(e){if(!e||!e.length)return null;var t=e.map(function(e){return e.name}).join(".");var r=e.params;return{name:t,params:r}}},{key:"matchPath",value:function v(e){var t=arguments.length<=1||arguments[1]===undefined?false:arguments[1];return this.getMatchPathFromSegments(this.getSegmentsMatchingPath(e,t))}}]);return e}();var g={ROUTER_NOT_STARTED:"NOT_STARTED",ROUTER_ALREADY_STARTED:"ALREADY_STARTED",ROUTE_NOT_FOUND:"ROUTE_NOT_FOUND",SAME_STATES:"SAME_STATES",CANNOT_DEACTIVATE:"CANNOT_DEACTIVATE",CANNOT_ACTIVATE:"CANNOT_ACTIVATE",TRANSITION_ERR:"TRANSITION_ERR",NODE_LISTENER_ERR:"NODE_ERR",TRANSITION_CANCELLED:"CANCELLED"};function y(){var e=arguments;return function(){return e[0]}}var S=function S(){};var _=typeof e!=="undefined";var E=function E(){return e.location.pathname.replace(/\/$/,"")};var k=function k(t,r,n){return e.history.pushState(t,r,n)};var A=function A(t,r,n){return e.history.replaceState(t,r,n)};var T=function T(t){return e.addEventListener("popstate",t)};var b=function b(t){return e.removeEventListener("popstate",t)};var w=function w(t){var r=t.useHash?e.location.hash.replace(new RegExp("^#"+t.hashPrefix),""):e.location.pathname.replace(new RegExp("^"+t.base),"");return r+e.location.search};var P=function P(){return e.history.state};var N={};if(_){N={getBase:E,pushState:k,replaceState:A,addPopstateListener:T,removePopstateListener:b,getLocation:w,getState:P}}else{N={getBase:y(""),pushState:S,replaceState:S,addPopstateListener:S,removePopstateListener:S,getLocation:y(""),getState:y(null)}}function R(e,t,r,n,a){var i=arguments.length<=5||arguments[5]===undefined?false:arguments[5];e=e||function(){return false};var u=t||[];var s=function s(e){if(!u.length)return true;var t=u[0].length;var a=u[0](r,n,e);if(typeof a==="boolean"){e(a?null:true)}else if(a&&typeof a.then==="function"){a.then(function(){return e(null)},function(){return e(true)})}else if(t<3&&i){e(null)}return false};var o=function o(e){if(e)a(e);else{u=u.slice(1);l()}};var l=function l(){if(e()){a(null)}else{var t=s(o);if(t)a(null)}};l()}function O(e,t){var r=function r(e){return e.split(".").reduce(function(e,t){return e.concat(e.length?e[e.length-1]+"."+t:t)},[])};var n=undefined;var a=t?r(t.name):[];var i=r(e.name);var u=Math.min(a.length,i.length);if(t&&t.name===e.name)n=Math.max(u-1,0);else{for(n=0;n<u;n+=1){if(a[n]!==i[n])break}}var s=a.slice(n).reverse();var o=i.slice(n);var l=t&&n>0?a[n-1]:"";return{intersection:l,toDeactivate:s,toActivate:o}}function L(e,t,r,n){var a=false;var i=function i(){return a};var u=function u(){return a=true};var s=function s(e){return n(a?g.TRANSITION_CANCELLED:e)};var o=O(t,r);var l=o.intersection;var f=o.toDeactivate;var c=o.toActivate;var h=function h(t,r,n){var a=f.map(function(t){return e._cmps[t]}).filter(function(e){return e&&e.canDeactivate}).map(function(e){return e.canDeactivate});R(i,a,t,r,function(e){return n(e?g.CANNOT_DEACTIVATE:null)})};var v=function v(t,r,n){var a=c.map(function(t){return e._canAct[t]}).filter(function(e){return e});R(i,a,t,r,function(e){return n(e?g.CANNOT_ACTIVATE:null)})};var m=e._onTr;var d=function d(e,t,r){var n=[m];R(i,n,e,t,function(e){return r(e?g.TRANSITION_ERR:null)})};var p=e._cbs["^"+l];var y=function y(e,t,r){var n=p;R(i,n,e,t,function(e){return r(e?g.NODE_LISTENER_ERR:null)},true)};var S=(r?[h]:[]).concat(v).concat(m?d:[]).concat(p&&p.length?y:[]);R(i,S,t,r,s);return u}var v=function(){function e(e,t){var r=[];var n=true;var a=false;var i=undefined;try{for(var u=e[Symbol.iterator](),s;!(n=(s=u.next()).done);n=true){r.push(s.value);if(t&&r.length===t)break}}catch(o){a=true;i=o}finally{try{if(!n&&u["return"])u["return"]()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,r)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var x=Array.prototype.slice;var t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,r,n){if(r)e(t.prototype,r);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var C=function C(e,t,r){return{name:e,params:t,path:r}};var D=function(){t(e,null,[{key:"ERR",value:g,enumerable:true},{key:"transitionPath",value:O,enumerable:true}]);function e(t){var n=this;var a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];r(this,e);this.started=false;this._onTr=null;this._cbs={};this._cmps={};this._canAct={};this.lastStateAttempt=null;this.lastKnownState=null;this.rootNode=t instanceof p?t:new p("","",t);this.options={useHash:false,hashPrefix:"",base:"",trailingSlash:0};Object.keys(a).forEach(function(e){return n.options[e]=a[e]});this._setBase();this.boundOnPopState=this.onPopState.bind(this)}t(e,[{key:"_setBase",value:function n(){if(this.options.useHash&&!this.options.base)this.options.base=N.getBase()}},{key:"setOption",value:function a(e,t){this.options[e]=t;if(e==="useHash")this._setBase();return this}},{key:"add",value:function i(e){this.rootNode.add(e);return this}},{key:"addNode",value:function u(e,t,r){this.rootNode.addNode(e,t);if(r)this._canAct[e]=r;return this}},{key:"onPopState",value:function s(e){var t=this;var r=!e.state||!e.state.name;var n=e.state||this.matchPath(this.getLocation());var a=this.options;if(!n){this.navigate(a.defaultRoute,a.defaultParams,{reload:true,replace:true});return}if(this.lastKnownState&&this.areStatesEqual(n,this.lastKnownState)){return}this._transition(n,this.lastKnownState,function(e,i){if(e){if(e===g.CANNOT_DEACTIVATE){var u=t.buildUrl(t.lastKnownState.name,t.lastKnownState.params);if(!r){t.updateBrowserState(n,u,true)}}else{t.navigate(a.defaultRoute,a.defaultParams,{reload:true,replace:true})}}else{t.updateBrowserState(i,t.buildUrl(i.name,i.params),r)}})}},{key:"onTransition",value:function o(e){this._onTr=e;return this}},{key:"start",value:function l(){var e=this;var t=[].concat(x.call(arguments));var r=t.slice(-1)[0];var n=r instanceof Function?r:null;var a=undefined,i=undefined;if(this.started){if(n)n(g.ROUTER_ALREADY_STARTED);return this}if(t.length>0){if(typeof t[0]==="string")a=t[0];if(typeof t[0]==="object")i=t[0]}this.started=true;var u=this.options;var s=function s(t,r){var a=arguments.length<=2||arguments[2]===undefined?true:arguments[2];N.addPopstateListener(e.boundOnPopState);if(n)n(t,r);if(t&&a)e._invokeListeners("$error",r,null,t)};if(!a&&!i)a=this.getLocation();if(!i){(function(){i=e.matchPath(a);var t=function t(){return e.navigate(u.defaultRoute,u.defaultParams,{replace:true},function(e,t){return s(e,t,false)})};if(i){e.lastStateAttempt=i;e._transition(e.lastStateAttempt,e.lastKnownState,function(r,n){if(!r){e.updateBrowserState(e.lastKnownState,e.buildUrl(i.name,i.params),true);s(null,n)}else if(u.defaultRoute)t();else s(r,null,false)})}else if(u.defaultRoute){t()}else{s(g.ROUTE_NOT_FOUND,null)}})()}else{this.lastKnownState=i;this.updateBrowserState(this.lastKnownState,this.buildUrl(i.name,i.params),true);s(null,i)}return this}},{key:"stop",value:function f(){if(!this.started)return this;this.lastKnownState=null;this.lastStateAttempt=null;this.started=false;N.removePopstateListener(this.boundOnPopState);return this}},{key:"getState",value:function c(){return this.lastKnownState}},{key:"isActive",value:function h(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var r=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var n=arguments.length<=3||arguments[3]===undefined?true:arguments[3];var a=this.getState();if(!a)return false;if(r||a.name===e){return this.areStatesEqual(C(e,t),a,n)}return this.areStatesDescendants(C(e,t),a)}},{key:"areStatesEqual",value:function m(e,t){var r=this;var n=arguments.length<=2||arguments[2]===undefined?true:arguments[2];if(e.name!==t.name)return false;var a=function a(e){return r.rootNode.getSegmentsByName(e).map(function(e){return e.parser[n?"urlParams":"params"]}).reduce(function(e,t){return e.concat(t)},[])};var i=a(e.name);var u=a(t.name);return i.length===u.length&&i.every(function(r){return e.params[r]===t.params[r]})}},{key:"areStatesDescendants",value:function d(e,t){var r=new RegExp("^"+e.name+"\\.(.*)$");if(!r.test(t.name))return false;return Object.keys(e.params).every(function(r){return e.params[r]===t.params[r]})}},{key:"_invokeListeners",value:function y(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++){r[n-1]=arguments[n]}(this._cbs[e]||[]).forEach(function(e){return e.apply(undefined,r)})}},{key:"_addListener",value:function S(e,t,r){var n=e.replace(/^(\*|\^|=)/,"");if(n&&!/^\$/.test(e)){var a=this.rootNode.getSegmentsByName(n);if(!a)console.warn("No route found for "+n+", listener might never be called!")}if(!this._cbs[e])this._cbs[e]=[];this._cbs[e]=(r?[]:this._cbs[e]).concat(t);return this}},{key:"_removeListener",value:function _(e,t){if(this._cbs[e])this._cbs[e]=this._cbs[e].filter(function(e){return e!==t});return this}},{key:"addListener",value:function E(e){return this._addListener("*",e)}},{key:"removeListener",value:function k(e){return this._removeListener("*",e)}},{key:"addNodeListener",value:function A(e,t){return this._addListener("^"+e,t,true)}},{key:"removeNodeListener",value:function T(e,t){this._cbs["^"+e]=[];return this}},{key:"addRouteListener",value:function b(e,t){return this._addListener("="+e,t)}},{key:"removeRouteListener",value:function w(e,t){return this._removeListener("="+e,t)}},{key:"onTransitionStart",value:function P(e){return this._addListener("$start",e)}},{key:"offTransitionStart",value:function R(e){return this._removeListener("$start",e)}},{key:"onTransitionCancel",value:function D(e){return this._addListener("$cancel",e)}},{key:"offTransitionCancel",value:function j(e){return this._removeListener("$cancel",e)}},{key:"onTransitionError",value:function U(e){return this._addListener("$error",e)}},{key:"offTransitionError",value:function $(e){return this._removeListener("$error",e)}},{key:"registerComponent",value:function I(e,t){if(this._cmps[e])console.warn("A component was alread registered for route node "+e+".");this._cmps[e]=t;return this}},{key:"deregisterComponent",value:function B(e){delete this._cmps[e]}},{key:"canActivate",value:function K(e,t){this._canAct[e]=t;return this}},{key:"getLocation",value:function M(){return N.getLocation(this.options)}},{key:"buildUrl",value:function q(e,t){return this._buildUrl(this.rootNode.buildPath(e,t))}},{key:"_buildUrl",value:function F(e){return this.options.base+(this.options.useHash?"#"+this.options.hashPrefix:"")+e}},{key:"buildPath",value:function z(e,t){return this.rootNode.buildPath(e,t)}},{key:"matchPath",value:function Z(e){var t=this.rootNode.matchPath(e,this.options.trailingSlash);return t?C(t.name,t.params,e):null}},{key:"urlToPath",value:function V(e){var t=e.match(/^(?:http|https)\:\/\/(?:[0-9a-z_\-\.\:]+?)(?=\/)(.*)$/);var r=t?t[1]:e;var n=r.match(/^(.*?)(#.*?)?(\?.*)?$/);if(!n)throw new Error("Could not parse url "+e);var a=n.slice(1);var i=v(a,3);var u=i[0];var s=i[1];var o=i[2];var l=this.options;return(l.useHash?s.replace(new RegExp("^#"+l.hashPrefix),""):u.replace(new RegExp("^"+l.base),""))+(o||"")}},{key:"matchUrl",value:function H(e){return this.matchPath(this.urlToPath(e))}},{key:"_transition",value:function Q(e,t,r){var n=this;if(this._tr)this._tr();this._invokeListeners("$start",e,t);var a=L(this,e,t,function(a){n._tr=null;if(a){if(a===g.TRANSITION_CANCELLED)n._invokeListeners("$cancel",e,t);else n._invokeListeners("$error",e,t,a);if(r)r(a);return}n.lastKnownState=e;n._invokeListeners("="+e.name,e,t);n._invokeListeners("*",e,t);if(r)r(null,e)});this._tr=a;return function(){return!a||a()}}},{key:"navigate",value:function Y(e,t,r,n){if(t===undefined)t={};var a=this;if(r===undefined)r={};if(!this.started){if(n)n(g.ROUTER_NOT_STARTED);return}if(!N.getState())r.replace=true;var i=this.buildPath(e,t);var u=this.buildUrl(e,t);if(!i){if(n)n(g.ROUTE_NOT_FOUND);this._invokeListeners("$error",null,this.lastKnownState,g.ROUTE_NOT_FOUND);return}var s=C(e,t,i);this.lastStateAttempt=s;var o=this.lastKnownState?this.areStatesEqual(this.lastKnownState,this.lastStateAttempt):false;if(o&&!r.reload){if(n)n(g.SAME_STATES);this._invokeListeners("$error",s,this.lastKnownState,g.SAME_STATES);return}return this._transition(s,o?null:this.lastKnownState,function(e,t){if(e){if(n)n(e);return}a.updateBrowserState(a.lastStateAttempt,u,r.replace);if(n)n(null,t)})}},{key:"updateBrowserState",value:function G(e,t){var r=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var n=arguments.length<=3||arguments[3]===undefined?"":arguments[3];N[r?"replaceState":"pushState"](e,n,t)}}]);return e}();e.RouteNode=p;e.Router5=D})(window);